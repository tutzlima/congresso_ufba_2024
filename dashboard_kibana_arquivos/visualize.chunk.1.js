(window.visualize_bundle_jsonpfunction=window.visualize_bundle_jsonpfunction||[]).push([[1],Array(39).concat([function(e,t,i){"use strict";var a,n=function(){return void 0===a&&(a=Boolean(window&&document&&document.all&&!window.atob)),a},s=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),r=[];function o(e){for(var t=-1,i=0;i<r.length;i++)if(r[i].identifier===e){t=i;break}return t}function l(e,t){for(var i={},a=[],n=0;n<e.length;n++){var s=e[n],l=t.base?s[0]+t.base:s[0],u=i[l]||0,d="".concat(l," ").concat(u);i[l]=u+1;var c=o(d),v={css:s[1],media:s[2],sourceMap:s[3]};-1!==c?(r[c].references++,r[c].updater(v)):r.push({identifier:d,updater:g(v,t),references:1}),a.push(d)}return a}function u(e){var t=document.createElement("style"),a=e.attributes||{};if(void 0===a.nonce){var n=i.nc;n&&(a.nonce=n)}if(Object.keys(a).forEach((function(e){t.setAttribute(e,a[e])})),"function"==typeof e.insert)e.insert(t);else{var r=s(e.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}return t}var d,c=(d=[],function(e,t){return d[e]=t,d.filter(Boolean).join("\n")});function v(e,t,i,a){var n=i?"":a.media?"@media ".concat(a.media," {").concat(a.css,"}"):a.css;if(e.styleSheet)e.styleSheet.cssText=c(t,n);else{var s=document.createTextNode(n),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(s,r[t]):e.appendChild(s)}}function p(e,t,i){var a=i.css,n=i.media,s=i.sourceMap;if(n?e.setAttribute("media",n):e.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=a;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(a))}}var f=null,h=0;function g(e,t){var i,a,n;if(t.singleton){var s=h++;i=f||(f=u(t)),a=v.bind(null,i,s,!1),n=v.bind(null,i,s,!0)}else i=u(t),a=p.bind(null,i,t),n=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return a(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a(e=t)}else n()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=n());var i=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var a=0;a<i.length;a++){var n=o(i[a]);r[n].references--}for(var s=l(e,t),u=0;u<i.length;u++){var d=o(i[u]);0===r[d].references&&(r[d].updater(),r.splice(d,1))}i=s}}}},function(e,t,i){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",a=e[3];if(!a)return i;if(t&&"function"==typeof btoa){var n=(r=a,o=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(l," */")),s=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[i].concat(s).concat([n]).join("\n")}var r,o,l;return[i].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,a){"string"==typeof e&&(e=[[null,e,""]]);var n={};if(a)for(var s=0;s<this.length;s++){var r=this[s][0];null!=r&&(n[r]=!0)}for(var o=0;o<e.length;o++){var l=[].concat(e[o]);a&&n[l[0]]||(i&&(l[2]?l[2]="".concat(i," and ").concat(l[2]):l[2]=i),t.push(l))}},t}},function(e,t,i){switch(window.__kbnThemeTag__){case"v7dark":return i(64);case"v7light":return i(66);case"v8dark":return i(68);case"v8light":return i(70)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(25);t.default=function(e){a.useEffect(e,[])}},function(e,t,i){"use strict";var a,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};a=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(i,a){function n(i){e.removeListener(t,s),a(i)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",n),i([].slice.call(arguments))}b(e,t,s,{once:!0}),"error"!==t&&function(e,t,i){"function"==typeof e.on&&b(e,"error",t,i)}(e,n,{once:!0})}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var l=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,i,a){var n,s,r,o;if(u(i),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),r=s[t]),void 0===r)r=s[t]=i,++e._eventsCount;else if("function"==typeof r?r=s[t]=a?[i,r]:[r,i]:a?r.unshift(i):r.push(i),(n=d(e))>0&&r.length>n&&!r.warned){r.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=r.length,o=l,console&&console.warn&&console.warn(o)}return e}function v(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,i){var a={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=v.bind(a);return n.listener=i,a.wrapFn=n,n}function f(e,t,i){var a=e._events;if(void 0===a)return[];var n=a[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):g(n,n.length)}function h(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function g(e,t){for(var i=new Array(t),a=0;a<t;++a)i[a]=e[a];return i}function b(e,t,i,a){if("function"==typeof e.on)a.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(s){a.once&&e.removeEventListener(t,n),i(s)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return d(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var a="error"===e,n=this._events;if(void 0!==n)a=a&&void 0===n.error;else if(!a)return!1;if(a){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var o=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw o.context=r,o}var l=n[e];if(void 0===l)return!1;if("function"==typeof l)s(l,this,t);else{var u=l.length,d=g(l,u);for(i=0;i<u;++i)s(d[i],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return u(t),this.on(e,p(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,p(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,a,n,s,r;if(u(t),void 0===(a=this._events))return this;if(void 0===(i=a[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){r=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(a[e]=i[0]),void 0!==a.removeListener&&this.emit("removeListener",e,r||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,a;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,s=Object.keys(i);for(a=0;a<s.length;++a)"removeListener"!==(n=s[a])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},o.prototype.listenerCount=h,o.prototype.eventNames=function(){return this._eventsCount>0?a(this._events):[]}},function(e,t,i){switch(window.__kbnThemeTag__){case"v7dark":return i(45);case"v7light":return i(47);case"v8dark":return i(49);case"v8light":return i(51)}},function(e,t,i){var a=i(39),n=i(46);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,i){(t=i(40)(!1)).push([e.i,".visAppWrapper{display:flex;flex-direction:column;flex-grow:1}\n",""]),e.exports=t},function(e,t,i){var a=i(39),n=i(48);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,i){(t=i(40)(!1)).push([e.i,".visAppWrapper{display:flex;flex-direction:column;flex-grow:1}\n",""]),e.exports=t},function(e,t,i){var a=i(39),n=i(50);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,i){(t=i(40)(!1)).push([e.i,".visAppWrapper{display:flex;flex-direction:column;flex-grow:1}\n",""]),e.exports=t},function(e,t,i){var a=i(39),n=i(52);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,i){(t=i(40)(!1)).push([e.i,".visAppWrapper{display:flex;flex-direction:column;flex-grow:1}\n",""]),e.exports=t},function(e,t,i){switch(window.__kbnThemeTag__){case"v7dark":return i(54);case"v7light":return i(56);case"v8dark":return i(58);case"v8light":return i(60)}},function(e,t,i){var a=i(39),n=i(55);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,i){(t=i(40)(!1)).push([e.i,".visListingTable__typeImage,.visListingTable__typeIcon{margin-right:8px;position:relative;top:-1px}.visListingTable__typeImage{width:16px;height:16px}.visListingTable__experimentalIcon{width:24px;vertical-align:baseline;padding:0 8px;margin-left:8px}.visListingTable__titleLink{text-align:left}.visListingCallout__link{text-decoration:underline}\n",""]),e.exports=t},function(e,t,i){var a=i(39),n=i(57);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,i){(t=i(40)(!1)).push([e.i,".visListingTable__typeImage,.visListingTable__typeIcon{margin-right:8px;position:relative;top:-1px}.visListingTable__typeImage{width:16px;height:16px}.visListingTable__experimentalIcon{width:24px;vertical-align:baseline;padding:0 8px;margin-left:8px}.visListingTable__titleLink{text-align:left}.visListingCallout__link{text-decoration:underline}\n",""]),e.exports=t},function(e,t,i){var a=i(39),n=i(59);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,i){(t=i(40)(!1)).push([e.i,".visListingTable__typeImage,.visListingTable__typeIcon{margin-right:8px;position:relative;top:-1px}.visListingTable__typeImage{width:16px;height:16px}.visListingTable__experimentalIcon{width:24px;vertical-align:baseline;padding:0 8px;margin-left:8px}.visListingTable__titleLink{text-align:left}.visListingCallout__link{text-decoration:underline}\n",""]),e.exports=t},function(e,t,i){var a=i(39),n=i(61);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,i){(t=i(40)(!1)).push([e.i,".visListingTable__typeImage,.visListingTable__typeIcon{margin-right:8px;position:relative;top:-1px}.visListingTable__typeImage{width:16px;height:16px}.visListingTable__experimentalIcon{width:24px;vertical-align:baseline;padding:0 8px;margin-left:8px}.visListingTable__titleLink{text-align:left}.visListingCallout__link{text-decoration:underline}\n",""]),e.exports=t},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(33).__importDefault(i(42));t.default=function(e){a.default((function(){e()}))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(33),n=i(25),s=a.__importDefault(i(42));t.default=function(e){var t=n.useRef(e);t.current=e,s.default((function(){return function(){return t.current()}}))}},function(e,t,i){var a=i(39),n=i(65);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,i){(t=i(40)(!1)).push([e.i,".visEditor{flex:1 1 auto;display:flex;flex-direction:column;height:100%}.visEditor>*{flex-shrink:0}@media only screen and (max-width: 574px){.visEditor .visualization{min-height:240px}}@media only screen and (min-width: 575px) and (max-width: 767px){.visEditor .visualization{min-height:240px}}@media only screen and (min-width: 768px) and (max-width: 991px){.visEditor .visualization{min-height:240px}}.visEditor>.visualize{height:100%;flex:1 1 auto;display:flex;z-index:0}.visEditor__content{flex:1 1 auto;display:flex;flex-direction:column;width:100%;z-index:0}.visEditor__content>*{flex-shrink:0}\n",""]),e.exports=t},function(e,t,i){var a=i(39),n=i(67);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,i){(t=i(40)(!1)).push([e.i,".visEditor{flex:1 1 auto;display:flex;flex-direction:column;height:100%}.visEditor>*{flex-shrink:0}@media only screen and (max-width: 574px){.visEditor .visualization{min-height:240px}}@media only screen and (min-width: 575px) and (max-width: 767px){.visEditor .visualization{min-height:240px}}@media only screen and (min-width: 768px) and (max-width: 991px){.visEditor .visualization{min-height:240px}}.visEditor>.visualize{height:100%;flex:1 1 auto;display:flex;z-index:0}.visEditor__content{flex:1 1 auto;display:flex;flex-direction:column;width:100%;z-index:0}.visEditor__content>*{flex-shrink:0}\n",""]),e.exports=t},function(e,t,i){var a=i(39),n=i(69);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,i){(t=i(40)(!1)).push([e.i,".visEditor{flex:1 1 auto;display:flex;flex-direction:column;height:100%}.visEditor>*{flex-shrink:0}@media only screen and (max-width: 574px){.visEditor .visualization{min-height:240px}}@media only screen and (min-width: 575px) and (max-width: 767px){.visEditor .visualization{min-height:240px}}@media only screen and (min-width: 768px) and (max-width: 991px){.visEditor .visualization{min-height:240px}}.visEditor>.visualize{height:100%;flex:1 1 auto;display:flex;z-index:0}.visEditor__content{flex:1 1 auto;display:flex;flex-direction:column;width:100%;z-index:0}.visEditor__content>*{flex-shrink:0}\n",""]),e.exports=t},function(e,t,i){var a=i(39),n=i(71);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var s={insert:"head",singleton:!1};a(n,s);e.exports=n.locals||{}},function(e,t,i){(t=i(40)(!1)).push([e.i,".visEditor{flex:1 1 auto;display:flex;flex-direction:column;height:100%}.visEditor>*{flex-shrink:0}@media only screen and (max-width: 574px){.visEditor .visualization{min-height:240px}}@media only screen and (min-width: 575px) and (max-width: 767px){.visEditor .visualization{min-height:240px}}@media only screen and (min-width: 768px) and (max-width: 991px){.visEditor .visualization{min-height:240px}}.visEditor>.visualize{height:100%;flex:1 1 auto;display:flex;z-index:0}.visEditor__content{flex:1 1 auto;display:flex;flex-direction:column;width:100%;z-index:0}.visEditor__content>*{flex-shrink:0}\n",""]),e.exports=t},function(e,t,i){"use strict";i.r(t),i.d(t,"renderApp",(function(){return ge}));var a=i(25),n=i.n(a),s=i(34),r=i.n(s),o=i(30),l=i(27),u=(i(44),i(11)),d=(i(53),i(28)),c=i(9),v=i(29),p=i(63),f=i.n(p),h=i(62),g=i.n(h),b=i(31),m=i(2),y=i(32),x=i(0),j=i(4),S=i(1);const O=(e,t,i,a)=>{let n=e.getUrlForApp(null!=i?i:m.a,{path:i?a:`#${a}`});const s=Object(j.a)().get("state:storeInSessionStorage"),r=t.get(S.b)||{};return n=Object(x.setStateToKbnUrl)(S.b,r,{useHash:s},n),n};var _=i(26);const T=(e,t,i)=>[{field:"title",name:c.i18n.translate("visualize.listing.table.titleColumnName",{defaultMessage:"Title"}),sortable:!0,render:(i,{editApp:a,editUrl:n,title:s,error:r,type:o})=>r?i:Object(_.jsx)(l.RedirectAppLinks,{application:e,className:"visListingTable__titleLink"},Object(_.jsx)(d.EuiLink,{href:O(e,t,a,n),onClick:()=>{(e=>{const t=Object(j.b)();t&&e&&t.reportUiCounter(m.a,y.METRIC_TYPE.CLICK,`${e}:add`)})("string"==typeof o?o:null==o?void 0:o.name)},"data-test-subj":`visListingTitleLink-${s.split(" ").join("-")}`},i))},{field:"typeTitle",name:c.i18n.translate("visualize.listing.table.typeColumnName",{defaultMessage:"Type"}),sortable:!0,render:(e,t)=>{return t.error?Object(_.jsx)(d.EuiBadge,{iconType:"alert",color:"warning"},t.error):Object(_.jsx)("span",null,(e=>{let t;return t=e.image?Object(_.jsx)("img",{className:"visListingTable__typeImage","aria-hidden":"true",alt:"",src:e.image}):Object(_.jsx)(d.EuiIcon,{className:"visListingTable__typeIcon","aria-hidden":"true",type:e.icon||"empty",size:"m"}),t})(t),t.typeTitle,"beta"===(i=t).stage?Object(_.jsx)(d.EuiBetaBadge,{className:"visListingTable__betaIcon",label:"B",title:c.i18n.translate("visualize.listing.betaTitle",{defaultMessage:"Beta"}),tooltipContent:c.i18n.translate("visualize.listing.betaTooltip",{defaultMessage:"This visualization is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features"})}):"experimental"===i.stage?Object(_.jsx)(d.EuiBetaBadge,{className:"visListingTable__experimentalIcon",label:"E",title:c.i18n.translate("visualize.listing.experimentalTitle",{defaultMessage:"Experimental"}),tooltipContent:c.i18n.translate("visualize.listing.experimentalTooltip",{defaultMessage:"This visualization might be changed or removed in a future release and is not subject to the support SLA."})}):void 0);var i}},{field:"description",name:c.i18n.translate("visualize.listing.table.descriptionColumnName",{defaultMessage:"Description"}),sortable:!0,render:(e,t)=>Object(_.jsx)("span",null,t.description)},...i?[i.ui.getTableColumnDefinition()]:[]];var E=i(35),z=i.n(E),I=i(5),w=i(36),L=i(37);const A=c.i18n.translate("visualize.editor.defaultEditBreadcrumbText",{defaultMessage:"Edit visualization"});function C(){return[{text:c.i18n.translate("visualize.listing.breadcrumb",{defaultMessage:"Visualize Library"}),href:`#${m.b.LANDING_PAGE_PATH}`}]}function M({byValue:e,originatingAppName:t,redirectToOrigin:i},a=A){return[...t?[{text:t,onClick:i}]:[],...e?[]:C(),{text:a}]}var N=i(12);const V=Object(L.withSuspense)(L.LazySavedObjectSaveModalDashboard),P=e=>{if(!e.visualize)return!1;return!!e.visualize.show},k=({hasUnsavedChanges:e,setHasUnsavedChanges:t,openInspector:i,originatingApp:a,setOriginatingApp:s,hasUnappliedChanges:r,visInstance:o,stateContainer:l,visualizationIdFromUrl:u,stateTransfer:d,embeddableId:v},{data:p,application:f,chrome:h,overlays:g,history:j,share:S,setActiveUrl:O,toastNotifications:T,visualizeCapabilities:E,dashboardCapabilities:L,i18n:{Context:A},dashboard:C,savedObjectsTagging:k,presentationUtil:F,usageCollection:U,getKibanaVersion:B,savedObjects:R,visualizations:D})=>{const{vis:H,embeddableHandler:q}=o,$=o.savedVis,G=e=>{U&&U.reportUiCounter(null!=a?a:m.a,y.METRIC_TYPE.CLICK,`${e}:save`)};async function Q(e){var i;const n=!Boolean($.id)||e.copyOnSave;l.transitions.setVis({title:$.title}),$.searchSourceFields=null===(i=H.data.searchSource)||void 0===i?void 0:i.getSerializedFields(),$.visState=l.getState().vis,$.uiStateJSON=H.uiState.toString(),t(!1);try{const t=await D.saveVisualization($,e);if(t)if(T.addSuccess({title:c.i18n.translate("visualize.topNavMenu.saveVisualization.successNotificationText",{defaultMessage:"Saved '{visTitle}'",values:{visTitle:$.title}}),"data-test-subj":"saveVisualizationSuccess"}),h.recentlyAccessed.add(Object(b.getFullPath)(t),$.title,String(t)),a&&e.returnToOrigin||e.dashboardId){if(!v){const e=`${m.b.EDIT_PATH}/${encodeURIComponent(t)}`;j.replace(e),O(e)}const i=a||"dashboards";let n;e.dashboardId&&(n="new"===e.dashboardId?"#/create":`#/view/${e.dashboardId}`),d?d.navigateToWithEmbeddablePackage(i,{state:{type:b.VISUALIZE_EMBEDDABLE_TYPE,input:{savedObjectId:t},embeddableId:e.copyOnSave?void 0:v,searchSessionId:p.search.session.getSessionId()},path:n}):f.navigateToApp(i,{path:n})}else s&&a&&n&&(s(void 0),d.clearEditorState(m.b.APP_ID)),h.docTitle.change($.lastSavedTitle),h.setBreadcrumbs(M({},$.lastSavedTitle)),t!==u&&j.replace({...j.location,pathname:`${m.b.EDIT_PATH}/${t}`});return{id:t}}catch(e){return console.error(e),T.addDanger({title:c.i18n.translate("visualize.topNavMenu.saveVisualization.failureNotificationText",{defaultMessage:"Error on saving '{visTitle}'",values:{visTitle:$.title}}),text:e.message,"data-test-subj":"saveVisualizationError"}),{error:e}}}const K=C.dashboardFeatureFlagConfig.allowByValueEmbeddables,W=!$.id&&K&&a?c.i18n.translate("visualize.topNavMenu.saveVisualizationToLibraryButtonLabel",{defaultMessage:"Save to library"}):a&&$.id?c.i18n.translate("visualize.topNavMenu.saveVisualizationAsButtonLabel",{defaultMessage:"Save as"}):c.i18n.translate("visualize.topNavMenu.saveVisualizationButtonLabel",{defaultMessage:"Save"}),J=a&&((null==$?void 0:$.id)||K),Y=E.save||K&&!J&&L.showWriteControls;return[{id:"inspector",label:c.i18n.translate("visualize.topNavMenu.openInspectorButtonLabel",{defaultMessage:"inspect"}),description:c.i18n.translate("visualize.topNavMenu.openInspectorButtonAriaLabel",{defaultMessage:"Open Inspector for visualization"}),testId:"openInspectorButton",disableButton:()=>!q.hasInspector||!q.hasInspector(),run:i,tooltip(){if(!q.hasInspector||!q.hasInspector())return c.i18n.translate("visualize.topNavMenu.openInspectorDisabledButtonTooltip",{defaultMessage:"This visualization doesn't support any inspectors."})}},{id:"share",label:c.i18n.translate("visualize.topNavMenu.shareVisualizationButtonLabel",{defaultMessage:"share"}),description:c.i18n.translate("visualize.topNavMenu.shareVisualizationButtonAriaLabel",{defaultMessage:"Share Visualization"}),testId:"shareTopNavButton",run:t=>{if(S){var i,a,n,s,u,d;const v=l.getState(),f=Object(I.parse)(j.location.search),h={visId:null==$?void 0:$.id,filters:v.filters,refreshInterval:void 0,timeRange:p.query.timefilter.timefilter.getTime(),uiState:v.uiState,query:v.query,vis:v.vis,linked:v.linked,indexPattern:null!==(i=null===(a=o.savedSearch)||void 0===a||null===(n=a.searchSource)||void 0===n||null===(s=n.getField("index"))||void 0===s?void 0:s.id)&&void 0!==i?i:f.indexPattern,savedSearchId:null!==(u=null===(d=o.savedSearch)||void 0===d?void 0:d.id)&&void 0!==u?u:f.savedSearchId};S.toggleShareContextMenu({anchorElement:t,allowEmbed:!0,allowShortUrl:Boolean(E.createShortUrl),shareableUrl:Object(x.unhashUrl)(window.location.href),objectId:null==$?void 0:$.id,objectType:"visualization",sharingData:{title:(null==$?void 0:$.title)||c.i18n.translate("visualize.reporting.defaultReportTitle",{defaultMessage:"Visualization [{date}]",values:{date:z()().toISOString(!0)}}),locatorParams:{id:N.a,version:B(),params:h}},isDirty:r||e,showPublicUrlSwitch:P})}},disableButton:!S||Boolean(!$.id&&K&&a)},...a?[{id:"cancel",label:c.i18n.translate("visualize.topNavMenu.cancelButtonLabel",{defaultMessage:"Cancel"}),emphasize:!1,description:c.i18n.translate("visualize.topNavMenu.cancelButtonAriaLabel",{defaultMessage:"Return to the last app without saving changes"}),testId:"visualizeCancelAndReturnButton",tooltip(){if(r||e)return c.i18n.translate("visualize.topNavMenu.cancelAndReturnButtonTooltip",{defaultMessage:"Discard your changes before finishing"})},run:async()=>{a&&f.navigateToApp(a)}}]:[],...Y?[{id:"save",iconType:J?void 0:"save",label:W,emphasize:!J,description:c.i18n.translate("visualize.topNavMenu.saveVisualizationButtonAriaLabel",{defaultMessage:"Save Visualization"}),testId:"visualizeSaveButton",disableButton:r,tooltip(){if(r)return c.i18n.translate("visualize.topNavMenu.saveVisualizationDisabledButtonTooltip",{defaultMessage:"Apply or Discard your changes before saving"})},run:()=>{const e=async({newTitle:e,newCopyOnSave:t,isTitleDuplicateConfirmed:a,onTitleDuplicate:n,newDescription:s,returnToOrigin:r,dashboardId:o,addToLibrary:l})=>{const u=$.title;$.title=e,q.updateInput({title:e}),$.description=s,k&&($.tags=i);const c={confirmOverwrite:!1,isTitleDuplicateConfirmed:a,onTitleDuplicate:n,returnToOrigin:r,dashboardId:o||void 0,copyOnSave:t};if(o&&!l){const t=`${m.b.LANDING_PAGE_PATH}`;j.replace(t),O(t);const i={input:{savedVis:{...H.serialize(),title:e,description:s}},embeddableId:v,type:b.VISUALIZE_EMBEDDABLE_TYPE,searchSessionId:p.search.session.getSessionId()},a="new"===o?"#/create":`#/view/${o}`;return d.navigateToWithEmbeddablePackage("dashboards",{state:i,path:a}),{id:!0}}G(H.type.name);const f=await Q(c);return f.id&&!f.error||($.title=u),f};let t,i=[];k&&(i=$.tags||[],t=Object(_.jsx)(k.ui.components.SavedObjectSaveModalTagSelector,{initialSelection:i,onTagsSelected:e=>{i=e}}));const s=!!a||!C.dashboardFeatureFlagConfig.allowByValueEmbeddables;let r;r=s?Object(_.jsx)(w.SavedObjectSaveModalOrigin,{documentInfo:$||{title:""},onSave:e,options:t,getAppNameFromId:d.getAppNameFromId,objectType:c.i18n.translate("visualize.topNavMenu.saveVisualizationObjectType",{defaultMessage:"visualization"}),onClose:()=>{},originatingApp:a,returnToOriginSwitchLabel:a&&v?c.i18n.translate("visualize.topNavMenu.updatePanel",{defaultMessage:"Update panel on {originatingAppName}",values:{originatingAppName:d.getAppNameFromId(a)}}):void 0}):Object(_.jsx)(V,{documentInfo:{id:E.save?null==$?void 0:$.id:void 0,title:(null==$?void 0:$.title)||"",description:(null==$?void 0:$.description)||""},canSaveByReference:Boolean(E.save),onSave:e,tagOptions:t,objectType:c.i18n.translate("visualize.topNavMenu.saveVisualizationObjectType",{defaultMessage:"visualization"}),onClose:()=>{}}),Object(w.showSaveModal)(r,A,s?n.a.Fragment:F.ContextProvider)}}]:[],...J?[{id:"saveAndReturn",label:c.i18n.translate("visualize.topNavMenu.saveAndReturnVisualizationButtonLabel",{defaultMessage:"Save and return"}),emphasize:!0,iconType:"checkInCircleFilled",description:c.i18n.translate("visualize.topNavMenu.saveAndReturnVisualizationButtonAriaLabel",{defaultMessage:"Finish editing visualization and return to the last app"}),testId:"visualizesaveAndReturnButton",disableButton:r||!L.showWriteControls,tooltip(){if(r)return c.i18n.translate("visualize.topNavMenu.saveAndReturnVisualizationDisabledButtonTooltip",{defaultMessage:"Apply or Discard your changes before finishing"})},run:async()=>{if(G(H.type.name),null==$||!$.id)return(()=>{if(!a)return;const e={input:{savedVis:H.serialize()},embeddableId:v,type:b.VISUALIZE_EMBEDDABLE_TYPE,searchSessionId:p.search.session.getSessionId()};d.navigateToWithEmbeddablePackage(a,{state:e})})();return Q({confirmOverwrite:!1,returnToOrigin:!0})}}]:[]]},F=({data:e})=>e.query.queryString.getDefaultQuery(),U=(e,t)=>{var i,a;const n=e.vis,s=t.visualizations.convertFromSerializedVis(n.serialize()),r="savedVis"in e?e.savedVis:void 0;return{uiState:r&&r.uiStateJSON?JSON.parse(r.uiStateJSON):n.uiState.toJSON(),query:(null===(i=n.data.searchSource)||void 0===i?void 0:i.getOwnField("query"))||F(t),filters:(null===(a=n.data.searchSource)||void 0===a?void 0:a.getOwnField("filter"))||[],vis:{...s.visState,title:n.title},linked:r&&r.id?!!r.savedSearchId:!!s.savedSearchId}},B=e=>{const[t,i]=Object(a.useState)();return Object(a.useEffect)((()=>{const t=e.getIsVisible$().subscribe((e=>{i(e)}));return()=>t.unsubscribe()}),[e]),t};var R=i(10);const D=(e,t,i,n,s,r)=>{const[o,l]=Object(a.useState)(!1),[u,d]=Object(a.useState)();return Object(a.useEffect)((()=>{if(n&&s){const{timefilter:{timefilter:a},filterManager:o,queryString:u,state$:c}=e.data.query,{embeddableHandler:v,savedSearch:p,vis:f}=s,h="savedVis"in s?s.savedVis:void 0,g=n.getState();d(g);const b=()=>{r?r.render({core:e,data:e.data,uiState:f.uiState,timeRange:a.getTime(),filters:o.getFilters(),query:u.getQuery(),linked:!!f.data.savedSearchId,savedSearch:p}):v.updateInput({timeRange:a.getTime(),filters:o.getFilters(),query:u.getQuery()})},m=c.subscribe({next:b,error:e.fatalErrors.add}),y=e=>{e&&h&&!h.savedSearchId&&p?(h.savedSearchId=p.id,f.data.savedSearchId=p.id,f.data.searchSource&&f.data.searchSource.setParent(p.searchSource)):!e&&h&&h.savedSearchId?(delete h.savedSearchId,delete f.data.savedSearchId):e||h||delete f.data.savedSearchId};g.uiState&&f.uiState.setSilent(g.uiState);const x=()=>{n.transitions.set("uiState",f.uiState.getChanges())};f.uiState.on("change",x);const j=n.subscribe((a=>{if(d(a),!h||!h.id||e.history.location.pathname.includes(h.id)){if(Object(R.isEqual)(a.uiState,f.uiState.getChanges())||f.uiState.set(a.uiState),h&&!Object(R.isEqual)({...e.visualizations.convertFromSerializedVis(f.serialize()).visState,title:f.title},a.vis)){const{aggs:e,...i}=a.vis;f.setState({...i,data:{aggs:e}}),v.reload(),t.emit("updateEditor")}y(a.linked),f.data.searchSource&&(f.data.searchSource.setField("query",a.query),f.data.searchSource.setField("filter",a.filters)),b(),i(!0)}})),S=()=>l(!0);return t.on("embeddableRendered",S),b(),()=>{l(!1),t.off("embeddableRendered",S),m.unsubscribe(),f.uiState.off("change",x),j()}}}),[n,t,s,e,i,r]),{isEmbeddableRendered:o,currentAppState:u}};var H=i(38),q=i(13);const $=async(e,t)=>{const{data:i,createVisEmbeddableFromObject:a,savedObjects:n,spaces:s}=t,r=await a(e,{id:"",timeRange:i.query.timefilter.timefilter.getTime(),filters:i.query.filterManager.getFilters(),searchSessionId:i.search.session.getSessionId()});let o;return r.getOutput$().subscribe((e=>{e.error&&!function(e){const t=e.original||e;return t instanceof q.SavedFieldNotFound||t instanceof q.SavedFieldTypeInvalidForAgg}(e.error)&&i.search.showError(e.error.original||e.error)})),e.data.savedSearchId&&(o=await Object(H.getSavedSearch)(e.data.savedSearchId,{search:i.search,savedObjectsClient:n.client,spaces:s}),await Object(H.throwErrorOnSavedSearchUrlConflict)(o)),{savedSearch:o,embeddableHandler:r}},G=async(e,t)=>{const{visualizations:i}=e,a=await i.getSavedVisualization(t);"string"!=typeof t&&(a.searchSourceFields={index:null==t?void 0:t.indexPattern});const n=i.convertToSerializedVis(a);let s=await i.createVis(n.type,n);if(s.type.setup)try{s=await s.type.setup(s)}catch{}const{embeddableHandler:r,savedSearch:o}=await $(s,e);return{vis:s,embeddableHandler:r,savedSearch:o,savedVis:a}},Q=(e,t,i,n,s)=>{const[r,o]=Object(a.useState)({}),l=Object(a.useRef)(null),u=Object(a.useRef)("");return Object(a.useEffect)((()=>{var a;const{chrome:d,history:v,dashboard:p,toastNotifications:f,stateTransferService:h,application:{navigateToApp:g}}=e,b=async()=>{try{let r;if("/create"===v.location.pathname){const t=Object(I.parse)(v.location.search),i=e.visualizations.all().find((({name:e})=>e===t.type));if(!i)throw new Error(c.i18n.translate("visualize.createVisualization.noVisTypeErrorMessage",{defaultMessage:"You must provide a valid visualization type"}));const a=i.requiresSearch&&i.options.showIndexSelection,n=t.indexPattern||t.savedSearchId;if(a&&!n)throw new Error(c.i18n.translate("visualize.createVisualization.noIndexPatternOrSavedSearchIdErrorMessage",{defaultMessage:"You must provide either an indexPattern or a savedSearchId"}));r=await G(e,t)}else r=await G(e,s);const{embeddableHandler:u,savedVis:f,vis:b}=r,m=n?h.getAppNameFromId(n):void 0,y=n?()=>g(n):void 0,x=Boolean(n)&&p.dashboardFeatureFlagConfig.allowByValueEmbeddables;let S;if(f.id?(d.setBreadcrumbs(M({originatingAppName:m,redirectToOrigin:y},f.title)),d.docTitle.change(f.title)):d.setBreadcrumbs(function({byValue:e,originatingAppName:t,redirectToOrigin:i}){return[...t?[{text:t,onClick:i}]:[],...e?[]:C(),{text:c.i18n.translate("visualize.editor.createBreadcrumb",{defaultMessage:"Create"})}]}({byValue:x,originatingAppName:m,redirectToOrigin:y})),l.current)if(i){var a;const e=Object(j.c)().get(null===(a=b.type.editorConfig)||void 0===a?void 0:a.editor);e&&(S=new e(l.current,b,t,u))}else u.render(l.current);o({savedVisInstance:r,visEditorController:S})}catch(t){try{((e,t,i)=>{const{history:a,setActiveUrl:n,toastNotifications:s,http:{basePath:r},application:{navigateToApp:o}}=e,l={app:"management",path:`kibana/objects/savedVisualizations/${i}`};Object(x.redirectWhenMissing)({history:a,navigateToApp:o,toastNotifications:s,basePath:r,mapping:{visualization:m.b.LANDING_PAGE_PATH,search:l,"index-pattern":l,"index-pattern-field":l},onBeforeRedirect(){n(m.b.LANDING_PAGE_PATH)}})(t)})(e,t,s)}catch(e){f.addWarning({title:c.i18n.translate("visualize.createVisualization.failedToLoadErrorMessage",{defaultMessage:"Failed to load the visualization"}),text:e.message}),v.replace(m.b.LANDING_PAGE_PATH)}}};void 0!==i&&(u.current?s&&u.current!==s&&(null===(a=r.savedVisInstance)||void 0===a?void 0:a.savedVis.id)!==s&&(u.current=s,o({}),b()):(u.current=s||"new",b()))}),[e,t,n,i,s,r.savedVisInstance,r.visEditorController]),Object(a.useEffect)((()=>()=>{var e;r.visEditorController?r.visEditorController.destroy():null!==(e=r.savedVisInstance)&&void 0!==e&&e.embeddableHandler&&r.savedVisInstance.embeddableHandler.destroy()}),[r]),{...r,visEditorRef:l}};var K=i(6);function W(e){if("table"!==e.vis.type)return e;const t=Object(R.get)(e,"vis.aggs");if(t){let i=0;const a=t.map((e=>"split"!==e.schema?e:(i++,1===i||(e.schema="bucket",e.params=Object(R.omit)(e.params,["row"])),e)));if(i<=1)return e;e.vis.aggs=a}return e}const J="_a";function Y(e){return Object(R.omitBy)(e,((e,t)=>"$"===t.charAt(0)||"_"===t.charAt(0)||Object(R.isFunction)(e)))}const Z={set:e=>(t,i)=>({...e,[t]:i}),setVis:e=>t=>({...e,vis:{...e.vis,...t}}),unlinkSavedSearch:e=>({query:t,parentFilters:i=[]})=>({...e,query:t||e.query,filters:Object(R.union)(e.filters,i),linked:!1}),updateVisState:e=>t=>({...e,vis:Y(t)}),updateSavedQuery:e=>t=>{const i={...e,savedQuery:t};return t||delete i.savedQuery,i}};function X({stateDefaults:e,kbnUrlStateStorage:t,byValue:i}){return i?function(e){const t=W({...e});return{stateContainer:Object(x.createStateContainer)(t,Z),stopStateSync:()=>{}}}(e):function({stateDefaults:e,kbnUrlStateStorage:t}){const i=W({...e,...t.get(J)});t.set(J,i,{replace:!0});const a=Object(x.createStateContainer)(i,Z),{start:n,stop:s}=Object(x.syncState)({storageKey:J,stateContainer:{...a,set:e=>{e&&a.set(e)}},stateStorage:t});return n(),{stateContainer:a,stopStateSync:s}}({stateDefaults:e,kbnUrlStateStorage:t})}const ee=(e,t,i)=>{const[n,s]=Object(a.useState)(!1),[r,o]=Object(a.useState)(null);return Object(a.useEffect)((()=>{if(i){const r=U(i,e),d=!("savedVis"in i),{stateContainer:v,stopStateSync:p}=X({stateDefaults:r,kbnUrlStateStorage:e.kbnUrlStateStorage,byValue:d}),f=v.getState(),h=({isDirty:t})=>{t||v.transitions.updateVisState(U(i,e).vis),s(t)};t.on("dirtyStateChange",h);const{filterManager:g,queryString:b}=e.data.query;g.setAppFilters(Object(R.cloneDeep)(f.filters)),b.setQuery((n=f.query,Object(R.has)(n,"language")?n:{query:n,language:"lucene"}));const y=Object(u.connectToQueryState)(e.data.query,{set:({filters:e,query:t})=>{v.transitions.set("filters",e),v.transitions.set("query",t)},get:()=>({filters:v.getState().filters,query:v.getState().query}),state$:v.state$.pipe(Object(K.map)((e=>({filters:e.filters,query:e.query}))))},{filters:u.esFilters.FilterStateStore.APP_STATE,query:!0});if(Object(R.isEqual)(f.vis,r.vis)&&Object(R.isEqual)(f.query,r.query)&&Object(R.isEqual)(f.filters,r.filters))o(v);else{var a;const{aggs:t,...n}=f.vis,s=f.query,r=f.filters,u=(null===(a=i.vis.data.searchSource)||void 0===a?void 0:a.getFields())||{};i.vis.setState({...n,data:{aggs:t,searchSource:{...u,query:s,filter:r},savedSearchId:i.vis.data.savedSearchId}}).then((()=>{o(v)})).catch((t=>{e.toastNotifications.addWarning({title:c.i18n.translate("visualize.visualizationLoadingFailedErrorMessage",{defaultMessage:"Failed to load the visualization"}),text:Object(l.toMountPoint)(Object(_.jsx)(l.MarkdownSimple,null,t.message))}),e.history.replace(`${m.b.LANDING_PAGE_PATH}?notFound=visualization`)}))}return()=>{t.off("dirtyStateChange",h),p(),y()}}var n}),[t,i,e]),{appState:r,hasUnappliedChanges:n}},te=(e,t,i,n)=>{Object(a.useEffect)((()=>{if(i&&n&&n.savedSearch&&n.vis.data.searchSource){const{savedSearch:a}=n,{searchSource:s}=n.vis.data,r=()=>{const t=a.searchSource,n=null==t?void 0:t.getParent(),r=null==t?void 0:t.getField("index");s.setField("index",r),s.setParent(n),i.transitions.unlinkSavedSearch({query:null==t?void 0:t.getField("query"),parentFilters:(null==t?void 0:t.getOwnField("filter"))||[]}),e.toastNotifications.addSuccess(c.i18n.translate("visualize.linkedToSearch.unlinkSuccessNotificationText",{defaultMessage:"Unlinked from saved search '{searchTitle}'",values:{searchTitle:a.title}}))};return t.on("unlinkFromSavedSearch",r),()=>{t.off("unlinkFromSavedSearch",r)}}}),[i,t,n,e.toastNotifications])},ie=(e,t,i,n,s)=>{const[r,o]=Object(a.useState)({}),l=Object(a.useRef)(null),u=Object(a.useRef)(!1);return Object(a.useEffect)((()=>{const{chrome:i,application:{navigateToApp:a},stateTransferService:r}=e;(async()=>{var d;if(!n||u.current||!l.current)return;const c=await(async(e,t)=>{const{visualizations:i}=e,a=t.savedVis,n=await i.getSavedVisualization();a.uiState&&0!==Object.keys(a.uiState).length&&(n.uiStateJSON=JSON.stringify(a.uiState));let s=await i.createVis(a.type,Object(R.cloneDeep)(a));if(s.type.setup)try{s=await s.type.setup(s)}catch{}const{embeddableHandler:r,savedSearch:o}=await $(s,e);return{vis:s,savedVis:n,embeddableHandler:r,savedSearch:o}})(e,n),{embeddableHandler:v,vis:p}=c;let f;const h=Object(j.c)().get(null===(d=p.type.editorConfig)||void 0===d?void 0:d.editor);h&&(f=new h(l.current,p,t,v));const g=s?r.getAppNameFromId(s):void 0,b=s?()=>a(s):void 0;null==i||i.setBreadcrumbs(M({byValue:!0,originatingAppName:g,redirectToOrigin:b})),u.current=!0,o({byValueVisInstance:c,visEditorController:f})})()}),[t,i,e,r.byValueVisInstance,r.visEditorController,n,s]),Object(a.useEffect)((()=>()=>{var e;r.visEditorController?r.visEditorController.destroy():null!==(e=r.byValueVisInstance)&&void 0!==e&&e.embeddableHandler&&r.byValueVisInstance.embeddableHandler.destroy()}),[r]),{...r,visEditorRef:l}},ae=()=>{const{services:{application:e,chrome:t,dashboard:i,history:s,toastNotifications:r,visualizations:u,stateTransferService:p,savedObjects:h,savedObjectsPublic:y,savedObjectsTagging:x,uiSettings:j,visualizeCapabilities:S,dashboardCapabilities:O,kbnUrlStateStorage:E}}=Object(l.useKibana)(),{pathname:z}=Object(o.useLocation)(),I=Object(a.useRef)((()=>{})),w=y.settings.getListingLimit();Object(a.useEffect)((()=>{"/new"===z?I.current=u.showNewVisModal({onClose:()=>{s.push(m.b.LANDING_PAGE_PATH)}}):I.current()}),[s,z,u]),g()((()=>{p.clearEditorState(),t.setBreadcrumbs([{text:c.i18n.translate("visualize.visualizeListingBreadcrumbsTitle",{defaultMessage:"Visualize Library"})}]),t.docTitle.change(c.i18n.translate("visualize.listingPageTitle",{defaultMessage:"Visualize Library"}))})),f()((()=>I.current()));const L=Object(a.useCallback)((()=>{I.current=u.showNewVisModal()}),[u]),A=Object(a.useCallback)((({editUrl:t,editApp:i})=>{i?e.navigateToApp(i,{path:t}):s.push(t)}),[e,s]),C=Object(a.useMemo)((()=>{return e=L,Object(_.jsx)(d.EuiEmptyPrompt,{iconType:"visualizeApp",title:Object(_.jsx)("h1",{id:"visualizeListingHeading"},Object(_.jsx)(v.FormattedMessage,{id:"visualize.listing.createNew.title",defaultMessage:"Create your first visualization"})),body:Object(_.jsx)("p",null,Object(_.jsx)(v.FormattedMessage,{id:"visualize.listing.createNew.description",defaultMessage:"You can create different visualizations based on your data."})),actions:Object(_.jsx)(d.EuiButton,{onClick:e,fill:!0,iconType:"plusInCircle","data-test-subj":"createVisualizationPromptButton"},Object(_.jsx)(v.FormattedMessage,{id:"visualize.listing.createNew.createButtonLabel",defaultMessage:"Create new visualization"}))});var e}),[L]),M=Object(a.useMemo)((()=>T(e,E,x)),[e,E,x]),N=Object(a.useCallback)((e=>{let t,i=e;if(x){const a=x.ui.parseSearchQuery(e,{useName:!0});i=a.searchTerm,t=a.tagReferences}const a=j.get(b.VISUALIZE_ENABLE_LABS_SETTING);return u.findListItems(i,w,t).then((({total:e,hits:t})=>({total:e,hits:t.filter((e=>{var t;return a||"experimental"!==(null===(t=e.type)||void 0===t?void 0:t.stage)}))})))}),[w,j,x,u]),V=Object(a.useCallback)((async e=>{await Promise.all(e.map((e=>h.client.delete(e.savedObjectType,e.id)))).catch((e=>{r.addError(e,{title:c.i18n.translate("visualize.visualizeListingDeleteErrorTitle",{defaultMessage:"Error deleting visualization"})})}))}),[h.client,r]),P=Object(a.useMemo)((()=>x?[x.ui.getSearchBarFilter({useName:!0})]:[]),[x]),k=Object(_.jsx)(v.FormattedMessage,{"data-test-subj":"visualize-dashboard-flow-prompt",id:"visualize.visualizeListingDashboardFlowDescription",defaultMessage:"Building a dashboard? Create and add your visualizations right from the {dashboardApp}.",values:{dashboardApp:Object(_.jsx)(d.EuiLink,{className:"visListingCallout__link",onClick:t=>{t.preventDefault(),e.navigateToUrl(e.getUrlForApp("dashboards"))}},Object(_.jsx)(v.FormattedMessage,{id:"visualize.visualizeListingDashboardAppName",defaultMessage:"Dashboard application"}))}});return Object(_.jsx)(l.TableListView,{headingId:"visualizeListingHeading",createItem:L,tableCaption:c.i18n.translate("visualize.listing.table.listTitle",{defaultMessage:"Visualize Library"}),findItems:N,deleteItems:S.delete?V:void 0,editItem:S.save?A:void 0,tableColumns:M,listingLimit:w,initialPageSize:y.settings.getPerPage(),initialFilter:"",rowHeader:"title",emptyPrompt:C,entityName:c.i18n.translate("visualize.listing.table.entityName",{defaultMessage:"visualization"}),entityNamePlural:c.i18n.translate("visualize.listing.table.entityNamePlural",{defaultMessage:"visualizations"}),tableListTitle:c.i18n.translate("visualize.listing.table.listTitle",{defaultMessage:"Visualize Library"}),toastNotifications:r,searchFilters:P},i.dashboardFeatureFlagConfig.allowByValueEmbeddables&&O.createNew&&Object(_.jsx)(n.a.Fragment,null,Object(_.jsx)(d.EuiCallOut,{size:"s",title:k,iconType:"iInCircle"}),Object(_.jsx)(d.EuiSpacer,{size:"m"})))};i(41);var ne=i(43);const se=({currentAppState:e,isChromeVisible:t,isEmbeddableRendered:i,hasUnsavedChanges:n,setHasUnsavedChanges:s,hasUnappliedChanges:r,originatingApp:o,setOriginatingApp:u,visInstance:d,stateContainer:v,visualizationIdFromUrl:p,embeddableId:f,onAppLeave:h})=>{const{services:g}=Object(l.useKibana)(),{TopNavMenu:b}=g.navigation.ui,{setHeaderActionMenu:y,visualizeCapabilities:x}=g,{embeddableHandler:j,vis:S}=d,[O,T]=Object(a.useState)(),E=Object(a.useCallback)((()=>{const e=j.openInspector();T(e)}),[j]),z=Object(a.useCallback)((async()=>{g.data.search.session.start(),await d.embeddableHandler.reload()}),[d.embeddableHandler,g.data.search.session]),I=Object(a.useCallback)(((e,t)=>{!1===t&&z()}),[z]),w=Object(a.useMemo)((()=>{if(i)return k({hasUnsavedChanges:n,setHasUnsavedChanges:s,hasUnappliedChanges:r,openInspector:E,originatingApp:o,setOriginatingApp:u,visInstance:d,stateContainer:v,visualizationIdFromUrl:p,stateTransfer:g.stateTransferService,embeddableId:f},g)}),[i,n,s,r,E,o,d,u,v,p,g,f]),[L,A]=Object(a.useState)(S.data.indexPattern?[S.data.indexPattern]:[]),C=()=>{const e=!S.data.indexPattern||!!S.data.indexPattern.timeFieldName;return S.type.options.showTimePicker&&e},M=S.type.options.showFilterBar,N=S.type.requiresSearch&&S.type.options.showQueryBar;return Object(a.useEffect)((()=>()=>{O&&O.close()}),[O]),Object(a.useEffect)((()=>(h((e=>o&&(r||n)&&!g.stateTransferService.isTransferInProgress?e.confirm(c.i18n.translate("visualize.confirmModal.confirmTextDescription",{defaultMessage:"Leave Visualize editor with unsaved changes?"}),c.i18n.translate("visualize.confirmModal.title",{defaultMessage:"Unsaved changes"})):e.default())),()=>{h((e=>e.default()))})),[h,o,n,r,x.save,g.stateTransferService.isTransferInProgress]),Object(a.useEffect)((()=>{S.data.indexPattern||(async()=>{let e;if(S.type.getUsedIndexPattern&&(e=await S.type.getUsedIndexPattern(S.params)),!e||!e.length){const t=await g.data.indexPatterns.getDefault();t&&(e=[t])}e&&A(e)})()}),[S.params,S.type,g.data.indexPatterns,S.data.indexPattern]),Object(a.useEffect)((()=>{const e=g.data.query.timefilter.timefilter.getAutoRefreshFetch$().subscribe((async e=>{try{await z()}finally{e()}}));return()=>{e.unsubscribe()}}),[g.data.query.timefilter.timefilter,z]),t?Object(_.jsx)(b,{appName:m.a,config:w,setMenuMountPoint:y,onQuerySubmit:I,savedQueryId:e.savedQuery,onSavedQueryIdChange:v.transitions.updateSavedQuery,indexPatterns:L,screenTitle:S.title,showAutoRefreshOnly:!C(),showDatePicker:C(),showFilterBar:M,showQueryInput:N,showSaveQuery:Boolean(g.visualizeCapabilities.saveQuery),showSearchBar:!0,useDefaultBehaviors:!0}):M?Object(_.jsx)(b,{appName:m.a,setMenuMountPoint:y,indexPatterns:L,showSearchBar:!0,showSaveQuery:!1,showDatePicker:!1,showQueryInput:!1}):null},re=Object(a.memo)(se),oe=()=>{const e=Object(_.jsx)(n.a.Fragment,null,Object(_.jsx)(v.FormattedMessage,{id:"visualize.experimentalVisInfoText",defaultMessage:"This visualization is experimental and is not subject to the support SLA of official GA features. For feedback, please create an issue in {githubLink}.",values:{githubLink:Object(_.jsx)(d.EuiLink,{external:!0,href:"https://github.com/elastic/kibana/issues/new/choose",target:"_blank"},"GitHub")}}));return Object(_.jsx)(d.EuiCallOut,{className:"hide-for-sharing","data-test-subj":"experimentalVisInfo",size:"s",title:e,iconType:"beaker"})},le=Object(a.memo)(oe),ue=({visInstance:e,appState:t,currentAppState:i,isChromeVisible:n,hasUnsavedChanges:s,setHasUnsavedChanges:r,hasUnappliedChanges:o,isEmbeddableRendered:u,onAppLeave:p,originatingApp:f,setOriginatingApp:h,visualizationIdFromUrl:g,embeddableId:m,visEditorRef:y})=>{var x,j,S,O,T,E,z;const{services:I}=Object(l.useKibana)();Object(a.useEffect)((()=>{!async function(){const t=null==e?void 0:e.savedVis.sharingSavedObjectProps;if(I.spaces&&"aliasMatch"===(null==t?void 0:t.outcome)){var i;const a=null==t?void 0:t.aliasTargetId,n=`${Object(b.urlFor)(a)}${I.history.location.search}`;await I.spaces.ui.redirectLegacyUrl(n,c.i18n.translate("visualize.legacyUrlConflict.objectNoun",{defaultMessage:"{visName} visualization",values:{visName:null==e||null===(i=e.vis)||void 0===i?void 0:i.type.title}}))}else;}()}),[null==e?void 0:e.savedVis.sharingSavedObjectProps,null==e||null===(x=e.vis)||void 0===x?void 0:x.type.title,I]);const w=Object(a.useCallback)((()=>{const t=null==e?void 0:e.savedVis.id,i=null==e?void 0:e.savedVis.sharingSavedObjectProps;if(I.spaces&&"conflict"===(null==i?void 0:i.outcome)&&t){var a;const n=null==i?void 0:i.aliasTargetId,s=`${Object(b.urlFor)(n)}${I.history.location.search}`;return I.spaces.ui.components.getLegacyUrlConflict({objectNoun:c.i18n.translate("visualize.legacyUrlConflict.objectNoun",{defaultMessage:"{visName} visualization",values:{visName:null==e||null===(a=e.vis)||void 0===a?void 0:a.type.title}}),currentObjectId:t,otherObjectId:n,otherObjectPath:s})}return null}),[null==e?void 0:e.savedVis,I,null==e||null===(j=e.vis)||void 0===j?void 0:j.type.title]);return Object(_.jsx)("div",{className:`app-container visEditor visEditor--${null==e?void 0:e.vis.type.name}`},e&&t&&i&&Object(_.jsx)(re,{currentAppState:i,hasUnsavedChanges:s,setHasUnsavedChanges:r,isChromeVisible:n,isEmbeddableRendered:u,hasUnappliedChanges:o,originatingApp:f,setOriginatingApp:h,visInstance:e,stateContainer:t,visualizationIdFromUrl:g,embeddableId:m,onAppLeave:p}),"experimental"===(null==e||null===(S=e.vis)||void 0===S||null===(O=S.type)||void 0===O?void 0:O.stage)&&Object(_.jsx)(le,null),null==e||null===(T=e.vis)||void 0===T||null===(E=T.type)||void 0===E||null===(z=E.getInfoMessage)||void 0===z?void 0:z.call(E,e.vis),w(),e&&Object(_.jsx)(d.EuiScreenReaderOnly,null,Object(_.jsx)("h1",null,"savedVis"in e&&e.savedVis.id?Object(_.jsx)(v.FormattedMessage,{id:"visualize.pageHeading",defaultMessage:"{chartName} {chartType} visualization",values:{chartName:e.savedVis.title,chartType:e.vis.type.title}}):Object(_.jsx)(v.FormattedMessage,{id:"visualize.byValue_pageHeading",defaultMessage:"Visualization of type {chartType} embedded into {originatingApp} app",values:{chartType:e.vis.type.title,originatingApp:f||"dashboards"}}))),Object(_.jsx)("div",{className:n?"visEditor__content":"visualize",ref:y}))};var de=i(18);const ce=({onAppLeave:e})=>{const{id:t}=Object(o.useParams)(),[i,n]=Object(a.useState)(),[s,r]=Object(a.useState)(),{services:u}=Object(l.useKibana)(),[d]=Object(a.useState)(new ne.EventEmitter),[c,v]=Object(a.useState)(!t),p=B(u.chrome),{savedVisInstance:f,visEditorRef:h,visEditorController:g}=Q(u,d,p,i,t),{appState:b,hasUnappliedChanges:m}=ee(u,d,f),{isEmbeddableRendered:y,currentAppState:x}=D(u,d,v,b,f,g);return te(u,d,b,f),Object(a.useEffect)((()=>{const{stateTransferService:e,data:t}=u,{originatingApp:i,searchSessionId:a,embeddableId:s}=e.getIncomingEditorState(de.VisualizeConstants.APP_ID)||{};a?t.search.session.continue(a):t.search.session.start(),r(s),n(i)}),[u]),Object(a.useEffect)((()=>()=>{d.removeAllListeners()}),[d,u]),Object(_.jsx)(ue,{visInstance:f,appState:b,currentAppState:x,isChromeVisible:p,hasUnsavedChanges:c,hasUnappliedChanges:m,isEmbeddableRendered:y,originatingApp:i,setOriginatingApp:n,visualizationIdFromUrl:t,setHasUnsavedChanges:v,visEditorRef:h,onAppLeave:e,embeddableId:s})};let ve;const pe=()=>{const{services:e}=Object(l.useKibana)();return Object(a.useEffect)((()=>{e.restorePreviousUrl();const{navigated:t}=e.urlForwarding.navigateToLegacyKibanaUrl(e.history.location.pathname+e.history.location.search);if(!t){const t=c.i18n.translate("visualize.noMatchRoute.bannerTitleText",{defaultMessage:"Page not found"});ve=e.overlays.banners.replace(ve,Object(l.toMountPoint)(Object(_.jsx)(d.EuiCallOut,{color:"warning",iconType:"iInCircle",title:t},Object(_.jsx)("p",null,Object(_.jsx)(v.FormattedMessage,{id:"visualize.noMatchRoute.bannerText",defaultMessage:"Visualize application doesn't recognize this route: {route}.",values:{route:Object(_.jsx)(d.EuiLink,{href:window.location.href},e.history.location.pathname)}}))))),setTimeout((()=>{e.overlays.banners.remove(ve)}),15e3),e.history.replace(m.b.LANDING_PAGE_PATH)}}),[e]),null},fe=({onAppLeave:e})=>{const[t,i]=Object(a.useState)(),{services:n}=Object(l.useKibana)(),[s]=Object(a.useState)(new ne.EventEmitter),[r,o]=Object(a.useState)(!1),[u,d]=Object(a.useState)(),[c,v]=Object(a.useState)();Object(a.useEffect)((()=>{const{stateTransferService:e,history:t,data:a}=n,{originatingApp:s,embeddableId:r,valueInput:o,searchSessionId:l}=e.getIncomingEditorState(de.VisualizeConstants.APP_ID)||{};i(s),v(o),d(r),o||t.replace(de.VisualizeConstants.LANDING_PAGE_PATH),l?a.search.session.continue(l):a.search.session.start()}),[n]);const p=B(n.chrome),{byValueVisInstance:f,visEditorRef:h,visEditorController:g}=ie(n,s,p,c,t),{appState:b,hasUnappliedChanges:m}=ee(n,s,f),{isEmbeddableRendered:y,currentAppState:x}=D(n,s,o,b,f,g);return te(n,s,b,f),Object(a.useEffect)((()=>()=>{s.removeAllListeners()}),[s]),Object(_.jsx)(ue,{visInstance:f,appState:b,currentAppState:x,isChromeVisible:p,hasUnsavedChanges:r,hasUnappliedChanges:m,isEmbeddableRendered:y,originatingApp:t,setOriginatingApp:i,setHasUnsavedChanges:o,visEditorRef:h,embeddableId:u,onAppLeave:e})},he=({onAppLeave:e})=>{const{services:{data:{query:t},kbnUrlStateStorage:i}}=Object(l.useKibana)(),{pathname:n}=Object(o.useLocation)();return Object(a.useEffect)((()=>{const{stop:e}=Object(u.syncQueryStateWithUrl)(t,i);return()=>e()}),[t,i,n]),Object(_.jsx)(o.Switch,null,Object(_.jsx)(o.Route,{exact:!0,path:`${m.b.EDIT_BY_VALUE_PATH}`},Object(_.jsx)(fe,{onAppLeave:e})),Object(_.jsx)(o.Route,{path:[m.b.CREATE_PATH,`${m.b.EDIT_PATH}/:id`]},Object(_.jsx)(ce,{onAppLeave:e})),Object(_.jsx)(o.Route,{exact:!0,path:[m.b.LANDING_PAGE_PATH,m.b.WIZARD_STEP_1_PAGE_PATH]},Object(_.jsx)(ae,null)),Object(_.jsx)(pe,null))},ge=({element:e,onAppLeave:t},i)=>{var a,n;a=i.chrome,n=i.docLinks,a.setHelpExtension({appName:c.i18n.translate("visualize.helpMenu.appName",{defaultMessage:"Visualize Library"}),links:[{linkType:"documentation",href:`${n.links.visualize.guide}`}]}),i.visualizeCapabilities.save||(e=>{e.setBadge({text:c.i18n.translate("visualize.badge.readOnly.text",{defaultMessage:"Read only"}),tooltip:c.i18n.translate("visualize.badge.readOnly.tooltip",{defaultMessage:"Unable to save visualizations to the library"}),iconType:"glasses"})})(i.chrome);const s=Object(_.jsx)(o.Router,{history:i.history},Object(_.jsx)(l.KibanaContextProvider,{services:i},Object(_.jsx)(i.presentationUtil.ContextProvider,null,Object(_.jsx)(i.i18n.Context,null,Object(_.jsx)(he,{onAppLeave:t})))));return r.a.render(s,e),()=>r.a.unmountComponentAtNode(e)}}])]);