(window.kbnSankeyVis_bundle_jsonpfunction=window.kbnSankeyVis_bundle_jsonpfunction||[]).push([[2],{18:function(e,t,r){const{bucketReplaceProperty:n}=r(19),s=r(20);e.exports=function(){function e(e){const r=new Map;return e.map((e=>{e.slice(0,-1).map(((e,n)=>{const s=t(n,e);r.set(s,e)}))})),r}function t(e,t){return s({layerIndex:e,nodeName:t})}function r(e,r){const n=new Map;return e.map((e=>{for(let r=0;r<e.length-2;r++){const i=e[r],a=e[r+1],o=e[e.length-1],l=t(r,i),c=t(r+1,a),u=s({sourceNodeId:l,targetNodeId:c}),g=n.get(u);if(g){const e=g+o;n.set(u,e)}else n.set(u,o)}})),n}function i(e){const t=new Map;return e.forEach((({nodeId:e},r)=>{t.set(e,r)})),t}function a(e){const t=[];return e.forEach(((e,r)=>{t.push({nodeId:r,name:e})})),t}function o(e,t){const r=[];return e.forEach(((e,n)=>{const{sourceNodeId:s,targetNodeId:i}=JSON.parse(n);r.push({source:t.get(s),target:t.get(i),value:e})})),r}return{_generateNodesMap:e,_getLinkId:function(e,t){return s({sourceNodeId:e,targetNodeId:t})},_getNodeId:t,_generateLinksMap:r,_generateNodeIdMap:i,_generateNodeArray:a,_convertLinksMapToArray:o,aggregate:function({rows:t,missingValues:s,groupBucket:l}){const c=function({rows:e,missingValues:t,groupBucket:r}){let s=[];return e.map((function(e){const i=Object.assign({},e);for(let e in i)"__missing__"===i[e]&&t.length>0&&n(t,i,e),"__other__"===i[e]&&r.length>0&&n(r,i,e),Object.defineProperty(i,e.split("-")[1],Object.getOwnPropertyDescriptor(i,e)),delete i[e];s.push(_.values(i))})),s}({rows:t,missingValues:s,groupBucket:l}),u=e(c),g=r(c),f=a(u),d=o(g,i(f));return{nodes:f.map((({name:e})=>({name:e}))),links:d}}}}()},19:function(e,t,r){"use strict";r.r(t),r.d(t,"bucketReplaceProperty",(function(){return n}));const n=(e,t,r)=>{const n=e.find((e=>e.hasOwnProperty(r)));return t[r]=n[r],t}},20:function(e,t,r){var n="undefined"!=typeof JSON?JSON:r(21);e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r=t.space||"";"number"==typeof r&&(r=Array(r+1).join(" "));var a,o="boolean"==typeof t.cycles&&t.cycles,l=t.replacer||function(e,t){return t},c=t.cmp&&(a=t.cmp,function(e){return function(t,r){var n={key:t,value:e[t]},s={key:r,value:e[r]};return a(n,s)}}),u=[];return function e(t,a,g,f){var d=r?"\n"+new Array(f+1).join(r):"",p=r?": ":":";if(g&&g.toJSON&&"function"==typeof g.toJSON&&(g=g.toJSON()),void 0!==(g=l.call(t,a,g))){if("object"!=typeof g||null===g)return n.stringify(g);if(s(g)){for(var m=[],y=0;y<g.length;y++){var h=e(g,y,g[y],f+1)||n.stringify(null);m.push(d+r+h)}return"["+m.join(",")+d+"]"}if(-1!==u.indexOf(g)){if(o)return n.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}u.push(g);var M=i(g).sort(c&&c(g));for(m=[],y=0;y<M.length;y++){var b=e(g,a=M[y],g[a],f+1);if(b){var N=n.stringify(a)+p+b;m.push(d+r+N)}}return u.splice(u.indexOf(g),1),"{"+m.join(",")+d+"}"}}({"":e},"",e,0)};var s=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},i=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},r=[];for(var n in e)t.call(e,n)&&r.push(n);return r}},21:function(e,t,r){t.parse=r(22),t.stringify=r(23)},22:function(e,t){var r,n,s,i,a={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},o=function(e){throw{name:"SyntaxError",message:e,at:r,text:s}},l=function(e){return e&&e!==n&&o("Expected '"+e+"' instead of '"+n+"'"),n=s.charAt(r),r+=1,n},c=function(){var e,t="";for("-"===n&&(t="-",l("-"));n>="0"&&n<="9";)t+=n,l();if("."===n)for(t+=".";l()&&n>="0"&&n<="9";)t+=n;if("e"===n||"E"===n)for(t+=n,l(),"-"!==n&&"+"!==n||(t+=n,l());n>="0"&&n<="9";)t+=n,l();if(e=+t,isFinite(e))return e;o("Bad number")},u=function(){var e,t,r,s="";if('"'===n)for(;l();){if('"'===n)return l(),s;if("\\"===n)if(l(),"u"===n){for(r=0,t=0;t<4&&(e=parseInt(l(),16),isFinite(e));t+=1)r=16*r+e;s+=String.fromCharCode(r)}else{if("string"!=typeof a[n])break;s+=a[n]}else s+=n}o("Bad string")},g=function(){for(;n&&n<=" ";)l()};i=function(){switch(g(),n){case"{":return function(){var e,t={};if("{"===n){if(l("{"),g(),"}"===n)return l("}"),t;for(;n;){if(e=u(),g(),l(":"),Object.hasOwnProperty.call(t,e)&&o('Duplicate key "'+e+'"'),t[e]=i(),g(),"}"===n)return l("}"),t;l(","),g()}}o("Bad object")}();case"[":return function(){var e=[];if("["===n){if(l("["),g(),"]"===n)return l("]"),e;for(;n;){if(e.push(i()),g(),"]"===n)return l("]"),e;l(","),g()}}o("Bad array")}();case'"':return u();case"-":return c();default:return n>="0"&&n<="9"?c():function(){switch(n){case"t":return l("t"),l("r"),l("u"),l("e"),!0;case"f":return l("f"),l("a"),l("l"),l("s"),l("e"),!1;case"n":return l("n"),l("u"),l("l"),l("l"),null}o("Unexpected '"+n+"'")}()}},e.exports=function(e,t){var a;return s=e,r=0,n=" ",a=i(),g(),n&&o("Syntax error"),"function"==typeof t?function e(r,n){var s,i,a=r[n];if(a&&"object"==typeof a)for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(void 0!==(i=e(a,s))?a[s]=i:delete a[s]);return t.call(r,n,a)}({"":a},""):a}},23:function(e,t){var r,n,s,i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function o(e){return i.lastIndex=0,i.test(e)?'"'+e.replace(i,(function(e){var t=a[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function l(e,t){var i,a,c,u,g,f=r,d=t[e];switch(d&&"object"==typeof d&&"function"==typeof d.toJSON&&(d=d.toJSON(e)),"function"==typeof s&&(d=s.call(t,e,d)),typeof d){case"string":return o(d);case"number":return isFinite(d)?String(d):"null";case"boolean":case"null":return String(d);case"object":if(!d)return"null";if(r+=n,g=[],"[object Array]"===Object.prototype.toString.apply(d)){for(u=d.length,i=0;i<u;i+=1)g[i]=l(i,d)||"null";return c=0===g.length?"[]":r?"[\n"+r+g.join(",\n"+r)+"\n"+f+"]":"["+g.join(",")+"]",r=f,c}if(s&&"object"==typeof s)for(u=s.length,i=0;i<u;i+=1)"string"==typeof(a=s[i])&&(c=l(a,d))&&g.push(o(a)+(r?": ":":")+c);else for(a in d)Object.prototype.hasOwnProperty.call(d,a)&&(c=l(a,d))&&g.push(o(a)+(r?": ":":")+c);return c=0===g.length?"{}":r?"{\n"+r+g.join(",\n"+r)+"\n"+f+"}":"{"+g.join(",")+"}",r=f,c}}e.exports=function(e,t,i){var a;if(r="",n="","number"==typeof i)for(a=0;a<i;a+=1)n+=" ";else"string"==typeof i&&(n=i);if(s=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return l("",{"":e})}},24:function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48IS0tIEZvbnQgQXdlc29tZSBGcmVlIDUuMTUuMiBieSBAZm9udGF3ZXNvbWUgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbSBMaWNlbnNlIC0gaHR0cHM6Ly9mb250YXdlc29tZS5jb20vbGljZW5zZS9mcmVlIChJY29uczogQ0MgQlkgNC4wLCBGb250czogU0lMIE9GTCAxLjEsIENvZGU6IE1JVCBMaWNlbnNlKSAtLT48cGF0aCBkPSJNNTA0Ljk3MSAzNTkuMDI5YzkuMzczIDkuMzczIDkuMzczIDI0LjU2OSAwIDMzLjk0MWwtODAgNzkuOTg0Yy0xNS4wMSAxNS4wMS00MC45NzEgNC40OS00MC45NzEtMTYuOTcxVjQxNmgtNTguNzg1YTEyLjAwNCAxMi4wMDQgMCAwIDEtOC43NzMtMy44MTJsLTcwLjU1Ni03NS41OTYgNTMuMzMzLTU3LjE0M0wzNTIgMzM2aDMydi0zOS45ODFjMC0yMS40MzggMjUuOTQzLTMxLjk5OCA0MC45NzEtMTYuOTcxbDgwIDc5Ljk4MXpNMTIgMTc2aDg0bDUyLjc4MSA1Ni41NTEgNTMuMzMzLTU3LjE0My03MC41NTYtNzUuNTk2QTExLjk5OSAxMS45OTkgMCAwIDAgMTIyLjc4NSA5NkgxMmMtNi42MjcgMC0xMiA1LjM3My0xMiAxMnY1NmMwIDYuNjI3IDUuMzczIDEyIDEyIDEyem0zNzIgMHYzOS45ODRjMCAyMS40NiAyNS45NjEgMzEuOTggNDAuOTcxIDE2Ljk3MWw4MC03OS45ODRjOS4zNzMtOS4zNzMgOS4zNzMtMjQuNTY5IDAtMzMuOTQxbC04MC03OS45ODFDNDA5Ljk0MyAyNC4wMjEgMzg0IDM0LjU4MiAzODQgNTYuMDE5Vjk2aC01OC43ODVhMTIuMDA0IDEyLjAwNCAwIDAgMC04Ljc3MyAzLjgxMkw5NiAzMzZIMTJjLTYuNjI3IDAtMTIgNS4zNzMtMTIgMTJ2NTZjMCA2LjYyNyA1LjM3MyAxMiAxMiAxMmgxMTAuNzg1YzMuMzI2IDAgNi41MDMtMS4zODEgOC43NzMtMy44MTJMMzUyIDE3NmgzMnoiLz48L3N2Zz4="},34:function(e,t,r){"use strict";r.r(t),r.d(t,"registerLegacyVis",(function(){return O}));var n=r(7),s=r.n(n),i=r(8),a=r(0);const{aggregate:o}=r(18);function l(e){const t={slices:[],tables:[]};t.tables.push({columns:e.columns,rows:e.rows});const r=[],n=[];return e.columns.forEach((e=>{e.meta.sourceParams.params.missingBucket&&r.push({[e.id]:e.meta.sourceParams.params.missingBucketLabel}),e.meta.sourceParams.params.otherBucket&&n.push({[e.id]:e.meta.sourceParams.params.otherBucketLabel})})),t.slices=o({rows:e.rows,missingValues:r,groupBucket:n}),t}var c=r(10);const u=async({abortSignal:e,aggs:t,filters:r,indexPattern:n,inspectorAdapters:s,metricsAtAllLevels:a,partialRows:o,query:l,searchSessionId:u,searchSource:g,timeFields:f,timeRange:d,getNow:p})=>{var m,y;const h=null==p?void 0:p(),M=g.createChild({callParentStartHandlers:!0}),b=M.createChild({callParentStartHandlers:!0});t.setTimeRange(d),Object.defineProperty(b,"history",{get:()=>g.history,set(e){g.history=e}}),b.setField("aggs",t),b.onRequestStart(((e,r)=>t.onSearchRequestStart(e,r)));const N=null==n||null===(m=n.getTimeField)||void 0===m?void 0:m.call(n),S=N?[N.name]:[],v=f&&f.length>0?f:S;t.setForceNow(h),t.setTimeFields(v),d&&v.length>0&&M.setField("filter",(()=>t.getSearchSourceTimeFilter(h))),b.setField("filter",r),b.setField("query",l),null===(y=s.requests)||void 0===y||y.reset();const{rawResponse:w}=await b.fetch$({abortSignal:e,sessionId:u,inspector:{adapter:s.requests,title:i.i18n.translate("data.functions.esaggs.inspector.dataRequest.title",{defaultMessage:"Data"}),description:i.i18n.translate("data.functions.esaggs.inspector.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})}}).toPromise(),A=d?Object(c.calculateBounds)(d,{forceNow:h}):null,j={metricsAtAllLevels:a,partialRows:o,timeRange:A?{from:A.min,to:A.max,timeFields:v}:void 0};return Object(c.tabifyAggResponse)(t,w,j)};const g="sankey",f=()=>({...d(g,l)}),d=(e,t)=>({name:e,type:"render",help:i.i18n.translate("visualizations.functions.visualization.help",{defaultMessage:"Sankey Diagram"}),args:{index:{types:["string"],default:"",help:"Index"},metricsAtAllLevels:{types:["boolean"],default:!1,help:"Metrics levels"},partialRows:{types:["boolean"],default:!1,help:"Partial rows"},schemas:{types:["string"],default:'"{}"',help:"Schemas"},visConfig:{types:["string"],default:'"{}"',help:"Visualization configuration"},uiState:{types:["string"],default:'"{}"',help:"User interface state"},aggConfigs:{types:["string"],default:'"{}"',help:"Aggregation configurations"}},async fn(r,i,{inspectorAdapters:o,getSearchSessionId:l}){const c=i.visConfig?JSON.parse(i.visConfig):{},g=i.schemas?JSON.parse(i.schemas):{},f=i.index?await Object(a.b)().get(i.index):null,d=i.aggConfigs?JSON.parse(i.aggConfigs):[],p=f?Object(a.d)().aggs.createAggConfigs(f,d):void 0,m=Object(a.e)().get(e);(r=await async function({partialRows:e,metricsAtAllLevels:t,visParams:r,timeRange:n,query:i,filters:o,inspectorAdapters:l,forceFetch:c,aggs:g,queryFilter:f,searchSessionId:d}){const p=f,m=1e4,y=Object(a.d)(),h=await y.searchSource.create();h.setField("index",g.indexPattern);let M=void 0!==r.hitsSize?Math.min(r.hitsSize,m):0;if(h.setField("size",M),void 0!==r.fieldColumns){r.fieldColumns.some((e=>"_source"===e.field.name))||h.setField("_source",r.fieldColumns.map((e=>e.field.name))),h.setField("docvalue_fields",r.fieldColumns.filter((e=>e.field.readFromDocValues)).map((e=>e.field.name)));const e={};r.fieldColumns.filter((e=>e.field.scripted)).forEach((t=>{e[t.field.name]={script:{source:t.field.script}}})),h.setField("script_fields",e)}void 0!==r.sortField&&(h.setField("sort",[{[r.sortField.name]:{order:r.sortOrder}}]),(void 0!==r.hitsSize&&r.hitsSize>m||r.csvFullExport)&&h.getField("sort").push({_id:{order:"asc",unmapped_type:"keyword"}})),0===g.aggs.length&&g.createAggConfig({id:"1",enabled:!0,type:"count",schema:"metric",params:{}});const b={searchSource:h,aggs:g,indexPattern:g.indexPattern,timeRange:n,query:i,filters:o,forceFetch:c,metricsAtAllLevels:t,partialRows:e,inspectorAdapters:l,filterManager:p,searchSessionId:d},N=await u(b),S=g.bySchemaName("split");if(S.length>0&&(S[0].params.row=r.row),N.totalHits=s.a.get(h,"finalResponse.hits.total",-1),N.aggs=g,N.columns.forEach((e=>{e.aggConfig=g.byId(e.meta.sourceParams.id.split(".")[0])})),void 0!==r.fieldColumns){if(N.fieldColumns=r.fieldColumns,N.hits=s.a.get(h,"finalResponse.hits.hits",[]),void 0!==r.hitsSize&&r.hitsSize>m&&N.totalHits>m){let e=r.hitsSize;do{e-=M;const t=N.hits[N.hits.length-1].sort;M=Math.min(e,m),h.setField("size",M),h.setField("search_after",t),await u(b);const r=s.a.get(h,"finalResponse.hits.hits",[]);for(let e=0;e<r.length;e++)N.hits.push(r[e])}while(e>M)}r.csvFullExport&&(N.request=b)}return N}({partialRows:i.partialRows,metricsAtAllLevels:i.metricsAtAllLevels,visParams:c,timeRange:Object(n.get)(r,"timeRange",null),query:Object(n.get)(r,"query",null),filters:Object(n.get)(r,"filters",null),inspectorAdapters:o,queryFilter:Object(a.a)(),aggs:p,forceFetch:!0,searchSessionId:l()})).columns&&(r.columns.forEach((e=>{e.aggConfig&&(e.aggConfig.aggConfigs.schemas=m.schemas.all)})),Object.keys(g).forEach((e=>{g[e].forEach((t=>{r.columns[t]&&r.columns[t].aggConfig&&(r.columns[t].aggConfig.schema=e)}))})),null!=o&&o.tables&&o.tables.logDatatable("default",r));const y=await t(r);return{type:"render",as:e,value:{visData:y,visType:m.name,visConfig:c}}}}),p=new Map,m=(e,t,n)=>({name:n,reuseDomNode:!0,render:async(t,n,s)=>{let i=p.get(t);if(!i){const{getTableVisualizationControllerClass:a}=await r.e(1).then(r.bind(null,33)),o=a(e);i=new o(t,n.visType),p.set(t,i),s.onDestroy((()=>{var e;null===(e=i)||void 0===e||e.destroy(),p.delete(t)}))}await i.render(n.visData,n.visConfig,s),s.done()}});var y=r(24),h=r.n(y),M=r(11),b=r(12),N=r.n(b),S=r(13);var v=r(9),w=r(14);const A=(e,t,r)=>{const n=Object(v.getVisSchemas)(e,t),s={...e.params,title:e.title},i=Object(w.buildExpressionFunction)(r,{visConfig:JSON.stringify(s),schemas:JSON.stringify(n),index:e.data.indexPattern.id,uiState:JSON.stringify(e.uiState),aggConfigs:JSON.stringify(e.data.aggs.aggs),partialRows:e.params.showPartialRows,metricsAtAllLevels:e.isHierarchical()});return Object(w.buildExpression)([i]).toAst()},j={name:"sankey",title:i.i18n.translate("visTypeTable.tableVisTitle",{defaultMessage:"Sankey Diagram"}),icon:h.a,description:i.i18n.translate("visTypeTable.tableVisDescription",{defaultMessage:"A sankey diagram is a type of flow diagram where flow quantities are depicted by proportional arrow magnitutes.."}),getSupportedTriggers:()=>[v.VIS_EVENT_TO_TRIGGER.filter],visConfig:{defaults:{perPage:10,showPartialRows:!1,showMetricsAtAllLevels:!1,sort:{columnIndex:null,direction:null},showTotal:!1,totalFunc:"sum",percentageCol:""}},editorConfig:{optionsTemplate:e=>Object(S.jsx)(N.a.Fragment,null),schemas:[{group:M.AggGroupNames.Metrics,name:"metric",title:i.i18n.translate("visTypeTable.tableVisEditorConfig.schemas.metricTitle",{defaultMessage:"Metric"}),aggFilter:["!geo_centroid","!geo_bounds","!filtered_metric","!single_percentile"],aggSettings:{top_hits:{allowStrings:!0}},min:1,defaults:[{type:"count",schema:"metric"}]},{group:M.AggGroupNames.Buckets,name:"bucket",title:i.i18n.translate("visTypeTable.tableVisEditorConfig.schemas.bucketTitle",{defaultMessage:"Split rows"}),aggFilter:["!filter"]}]},toExpressionAst:(e,t)=>A(e,t,g),hierarchicalData:e=>e.params.showPartialRows||e.params.showMetricsAtAllLevels,requiresSearch:!0},O=(e,{expressions:t,visualizations:r},n)=>{t.registerFunction(f),t.registerRenderer(((e,t)=>({...m(e,t,g)}))(e,n)),r.createBaseVisualization(j)}}}]);