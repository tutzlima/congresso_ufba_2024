/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15)}([function(e,t,n){e.exports=n(13)(1073)},function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t){e.exports=__kbnSharedDeps__.RxjsOperators},function(e,t,n){n.r(t);var a=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t,n){n.r(t);var a=__kbnBundles__.get("plugin/embeddableEnhanced/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t,n){n.r(t);var a=__kbnBundles__.get("plugin/data/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t,n){n.r(t);var a=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t,n){n.r(t);var a=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,n){e.exports=n(13)(1074)},function(e,t,n){n(16),__kbnBundles__.define("plugin/dashboardEnhanced/public",n,17)},function(e,t,n){n.p=window.__kbnPublicPath__.dashboardEnhanced},function(e,t,n){"use strict";n.r(t),n.d(t,"DashboardEnhancedAbstractDashboardDrilldown",(function(){return abstract_dashboard_drilldown_AbstractDashboardDrilldown})),n.d(t,"plugin",(function(){return k}));var a=n(0),r=n.n(a),o=n(3),s=n(8),i=n.n(s),d=n(4),c=n(2),l=n(10),b=n(9),u=n(6),h=n(7);function p(e){return e.includes(h.APPLY_FILTER_TRIGGER)||!e.includes(o.VALUE_CLICK_TRIGGER)&&!e.includes(o.SELECT_RANGE_TRIGGER)?e:[...e,h.APPLY_FILTER_TRIGGER]}const g=e=>{const t=[],n=e.id,a=e.getRoot();if(!a)return t;if(!(a instanceof o.Container))return t;const r=a.getChildIds();for(const e of r){const r=a.getChild(e);if(r.id===n)continue;if(!Object(u.isEnhancedEmbeddable)(r))continue;const o=r.enhancements.dynamicActions.state.get().events;for(const e of o){const n={id:e.eventId,name:e.action.name,icon:"dashboardApp",description:r.getTitle()||r.id,config:e.action.config,factoryId:e.action.factoryId,triggers:e.triggers};t.push(n)}}return t};var f=n(1);const _="OPEN_FLYOUT_ADD_DRILLDOWN";class flyout_create_drilldown_FlyoutCreateDrilldownAction{constructor(e){r()(this,"type",_),r()(this,"id",_),r()(this,"order",12),r()(this,"grouping",u.embeddableEnhancedDrilldownGrouping),this.params=e}getDisplayName(){return d.i18n.translate("xpack.dashboard.FlyoutCreateDrilldownAction.displayName",{defaultMessage:"Create drilldown"})}getIconType(){return"plusInCircle"}isEmbeddableCompatible(e){if(!Object(u.isEnhancedEmbeddable)(e.embeddable))return!1;const t=e.embeddable.supportedTriggers();if(!t||!t.length)return!1;if("dashboard"!==e.embeddable.getRoot().type)return!1;const n=this.params.start().plugins.uiActionsEnhanced.getActionFactories().map((e=>e.supportedTriggers())).reduce(((e,t)=>e.concat(t)),[]);return p(t).some((e=>n.includes(e)))}async isCompatible(e){return"edit"===e.embeddable.getInput().viewMode&&this.isEmbeddableCompatible(e)}async execute(e){const{core:t,plugins:n}=this.params.start(),{embeddable:a}=e;if(!Object(u.isEnhancedEmbeddable)(a))throw new Error("Need embeddable to be EnhancedEmbeddable to execute FlyoutCreateDrilldownAction.");const r=g(a),s=new l.Subject,i=()=>{s.next(!0),d.close()},d=t.overlays.openFlyout(Object(b.toMountPoint)(Object(f.jsx)(n.uiActionsEnhanced.DrilldownManager,{closeAfterCreate:!0,initialRoute:"/new",dynamicActionManager:a.enhancements.dynamicActions,triggers:[...p(a.supportedTriggers()),o.CONTEXT_MENU_TRIGGER],placeContext:{embeddable:a},templates:r,onClose:i})),{ownFocus:!0,"data-test-subj":"createDrilldownFlyout"});t.application.currentAppId$.pipe(Object(c.takeUntil)(s),Object(c.skip)(1),Object(c.take)(1)).subscribe((()=>{i()})),a.getInput$().pipe(Object(c.takeUntil)(s),Object(c.map)((e=>e.viewMode)),Object(c.distinctUntilChanged)(),Object(c.filter)((e=>e!==o.ViewMode.EDIT)),Object(c.take)(1)).subscribe((()=>{i()}))}}const m=d.i18n.translate("xpack.dashboard.panel.openFlyoutEditDrilldown.displayName",{defaultMessage:"Manage drilldowns"});var D=n(5),w=n(11);const j=({context:e})=>{const{events:t}=Object(w.useContainerState)(e.embeddable.enhancements.dynamicActions.state),n=t.length;return Object(f.jsx)(D.EuiFlexGroup,{alignItems:"center"},Object(f.jsx)(D.EuiFlexItem,{grow:!0},m),n>0&&Object(f.jsx)(D.EuiFlexItem,{grow:!1},Object(f.jsx)(D.EuiNotificationBadge,null,n)))},O="OPEN_FLYOUT_EDIT_DRILLDOWN";class flyout_edit_drilldown_FlyoutEditDrilldownAction{constructor(e){r()(this,"type",O),r()(this,"id",O),r()(this,"order",10),r()(this,"grouping",u.embeddableEnhancedDrilldownGrouping),r()(this,"MenuItem",Object(b.reactToUiComponent)(j)),this.params=e}getDisplayName(){return m}getIconType(){return"list"}async isCompatible({embeddable:e}){return e.getInput().viewMode===o.ViewMode.EDIT&&(!!Object(u.isEnhancedEmbeddable)(e)&&e.enhancements.dynamicActions.state.get().events.length>0)}async execute(e){const{core:t,plugins:n}=this.params.start(),{embeddable:a}=e;if(!Object(u.isEnhancedEmbeddable)(a))throw new Error("Need embeddable to be EnhancedEmbeddable to execute FlyoutEditDrilldownAction.");const r=g(a),s=new l.Subject,i=()=>{s.next(!0),d.close()},d=t.overlays.openFlyout(Object(b.toMountPoint)(Object(f.jsx)(n.uiActionsEnhanced.DrilldownManager,{initialRoute:"/manage",dynamicActionManager:a.enhancements.dynamicActions,triggers:[...p(a.supportedTriggers()),o.CONTEXT_MENU_TRIGGER],placeContext:{embeddable:a},templates:r,onClose:i})),{ownFocus:!0,"data-test-subj":"editDrilldownFlyout"});t.application.currentAppId$.pipe(Object(c.takeUntil)(s),Object(c.skip)(1),Object(c.take)(1)).subscribe((()=>{i()})),a.getInput$().pipe(Object(c.takeUntil)(s),Object(c.map)((e=>e.viewMode)),Object(c.distinctUntilChanged)(),Object(c.filter)((e=>e!==o.ViewMode.EDIT)),Object(c.take)(1)).subscribe((()=>{i()}))}}var C=n(14),E=n.n(C),v=n(12);const y=d.i18n.translate("xpack.dashboard.components.DashboardDrilldownConfig.chooseDestinationDashboard",{defaultMessage:"Choose destination dashboard"}),I=d.i18n.translate("xpack.dashboard.components.DashboardDrilldownConfig.useCurrentFilters",{defaultMessage:"Use filters and query from origin dashboard"}),x=d.i18n.translate("xpack.dashboard.components.DashboardDrilldownConfig.useCurrentDateRange",{defaultMessage:"Use date range from origin dashboard"}),R=({activeDashboardId:e,dashboards:t,currentFilters:n,keepRange:a,onDashboardSelect:r,onCurrentFiltersToggle:o,onKeepRangeToggle:s,onSearchChange:d,isLoading:c,error:l})=>{var b;const u=(null===(b=t.find((t=>t.value===e)))||void 0===b?void 0:b.label)||"";return Object(f.jsx)(i.a.Fragment,null,Object(f.jsx)(D.EuiFormRow,{label:y,fullWidth:!0,isInvalid:!!l,error:l},Object(f.jsx)(D.EuiComboBox,{async:!0,selectedOptions:e?[{label:u,value:e}]:[],options:t,onChange:([{value:e=""}={value:""}])=>r(e),onSearchChange:d,isLoading:c,singleSelection:{asPlainText:!0},fullWidth:!0,"data-test-subj":"dashboardDrilldownSelectDashboard",isInvalid:!!l})),!!o&&Object(f.jsx)(D.EuiFormRow,{hasChildLabel:!1},Object(f.jsx)(D.EuiSwitch,{name:"useCurrentFilters",label:I,checked:!!n,onChange:o})),!!s&&Object(f.jsx)(D.EuiFormRow,{hasChildLabel:!1},Object(f.jsx)(D.EuiSwitch,{name:"useCurrentDateRange",label:x,checked:!!a,onChange:s})))},T=(e,t)=>t&&-1===Object(v.findIndex)(e,{value:t.value})?[t,...e]:e,F=e=>({value:e.id,label:e.attributes.title});class collect_config_container_CollectConfigContainer extends i.a.Component{constructor(e){super(e),r()(this,"isMounted",!0),r()(this,"state",{dashboards:[],isLoading:!1,searchString:void 0,selectedDashboard:void 0,error:void 0}),r()(this,"debouncedLoadDashboards",void 0),this.debouncedLoadDashboards=Object(v.debounce)(this.loadDashboards.bind(this),500)}componentDidMount(){this.loadSelectedDashboard(),this.loadDashboards()}componentWillUnmount(){this.isMounted=!1}render(){const{config:e,onConfig:t}=this.props,{dashboards:n,selectedDashboard:a,isLoading:r,error:o}=this.state;return Object(f.jsx)(R,{activeDashboardId:e.dashboardId,dashboards:T(n,a),currentFilters:e.useCurrentFilters,keepRange:e.useCurrentDateRange,isLoading:r,error:o,onDashboardSelect:n=>{t({...e,dashboardId:n}),this.state.error&&this.setState({error:void 0})},onSearchChange:this.debouncedLoadDashboards,onCurrentFiltersToggle:()=>t({...e,useCurrentFilters:!e.useCurrentFilters}),onKeepRangeToggle:()=>t({...e,useCurrentDateRange:!e.useCurrentDateRange})})}async loadSelectedDashboard(){var e;const{config:t,params:{start:n}}=this.props;if(!t.dashboardId)return;const a=await n().core.savedObjects.client.get("dashboard",t.dashboardId);var r;return this.isMounted?404===(null===(e=a.error)||void 0===e?void 0:e.statusCode)?(this.setState({error:(r=t.dashboardId,d.i18n.translate("xpack.dashboard.drilldown.errorDestinationDashboardIsMissing",{defaultMessage:"Destination dashboard ('{dashboardId}') no longer exists. Choose another dashboard.",values:{dashboardId:r}}))}),void this.props.onConfig({...t,dashboardId:void 0})):a.error?(this.setState({error:a.error.message}),void this.props.onConfig({...t,dashboardId:void 0})):void this.setState({selectedDashboard:F(a)}):void 0}async loadDashboards(e){this.setState({searchString:e,isLoading:!0});const t=this.props.params.start().core.savedObjects.client,{savedObjects:n}=await t.find({type:"dashboard",search:e?`${e}*`:void 0,searchFields:["title^3","description"],defaultSearchOperator:"AND",perPage:100});if(!this.isMounted)return;if(e!==this.state.searchString)return;const a=n.map(F);this.setState({dashboards:a,isLoading:!1})}}const S=d.i18n.translate("xpack.dashboard.drilldown.goToDashboard",{defaultMessage:"Go to Dashboard"});class abstract_dashboard_drilldown_AbstractDashboardDrilldown{constructor(e){r()(this,"id",void 0),r()(this,"supportedTriggers",void 0),r()(this,"order",100),r()(this,"getDisplayName",(()=>S)),r()(this,"euiIcon","dashboardApp"),r()(this,"ReactCollectConfig",(e=>Object(f.jsx)(collect_config_container_CollectConfigContainer,E()({},e,{params:this.params})))),r()(this,"CollectConfig",Object(b.reactToUiComponent)(this.ReactCollectConfig)),r()(this,"createConfig",(()=>({dashboardId:"",useCurrentFilters:!0,useCurrentDateRange:!0}))),r()(this,"isConfigValid",(e=>!!e.dashboardId)),r()(this,"getHref",(async(e,t)=>{const{app:n,path:a}=await this.getLocation(e,t);return await this.params.start().core.application.getUrlForApp(n,{path:a,absolute:!0})})),r()(this,"execute",(async(e,t)=>{const{app:n,path:a,state:r}=await this.getLocation(e,t);await this.params.start().core.application.navigateToApp(n,{path:a,state:r})})),this.params=e}get locator(){const e=this.params.start().plugins.dashboard.locator;if(!e)throw new Error("Dashboard locator is required for dashboard drilldown.");return e}}const A=(e,t)=>`drilldown:${t}:${e.eventId}:dashboardId`;class embeddable_to_dashboard_drilldown_EmbeddableToDashboardDrilldown extends abstract_dashboard_drilldown_AbstractDashboardDrilldown{constructor(...e){super(...e),r()(this,"id","DASHBOARD_TO_DASHBOARD_DRILLDOWN"),r()(this,"supportedTriggers",(()=>[h.APPLY_FILTER_TRIGGER])),r()(this,"inject",(({drilldownId:e})=>(t,n)=>{const a=t.action,r=A(t,e),o=n.find((e=>e.name===r));return o?o.id&&o.id===a.config.dashboardId?t:((e,t)=>({...e,action:{...e.action,config:{...e.action.config,dashboardId:t}}}))(t,o.id):t})({drilldownId:this.id})),r()(this,"extract",(({drilldownId:e})=>t=>{const n=t.action,a=n.config.dashboardId?[{name:A(t,e),type:"dashboard",id:n.config.dashboardId}]:[],{dashboardId:r,...o}=n.config;return{state:{...t,action:{...t.action,config:o}},references:a}})({drilldownId:this.id}))}async getLocation(e,t){const n={dashboardId:e.dashboardId};if(t.embeddable){var a;const r=t.embeddable.getInput();Object(h.isQuery)(r.query)&&e.useCurrentFilters&&(n.query=r.query),Object(h.isTimeRange)(r.timeRange)&&e.useCurrentDateRange&&(n.timeRange=r.timeRange),Object(h.isFilters)(r.filters)&&(n.filters=e.useCurrentFilters?r.filters:null===(a=r.filters)||void 0===a?void 0:a.filter((e=>h.esFilters.isFilterPinned(e))))}const{restOfFilters:r,timeRange:o}=h.esFilters.extractTimeRange(t.filters,t.timeFieldName);var s;r&&(n.filters=[...null!==(s=n.filters)&&void 0!==s?s:[],...r]);o&&(n.timeRange=o);return await this.locator.getLocation(n)}}class dashboard_drilldowns_services_DashboardDrilldownsService{bootstrap(e,t,{enableDrilldowns:n}){n&&this.setupDrilldowns(e,t)}setupDrilldowns(e,{uiActionsEnhanced:t}){const n=Object(w.createStartServicesGetter)(e.getStartServices),a=new flyout_create_drilldown_FlyoutCreateDrilldownAction({start:n});t.addTriggerAction(o.CONTEXT_MENU_TRIGGER,a);const r=new flyout_edit_drilldown_FlyoutEditDrilldownAction({start:n});t.addTriggerAction(o.CONTEXT_MENU_TRIGGER,r);const s=new embeddable_to_dashboard_drilldown_EmbeddableToDashboardDrilldown({start:n});t.registerDrilldown(s)}}class plugin_DashboardEnhancedPlugin{constructor(e){r()(this,"drilldowns",new dashboard_drilldowns_services_DashboardDrilldownsService),this.context=e}setup(e,t){return this.drilldowns.bootstrap(e,t,{enableDrilldowns:!0}),{}}start(e,t){return{}}stop(){}}function k(e){return new plugin_DashboardEnhancedPlugin(e)}}]);