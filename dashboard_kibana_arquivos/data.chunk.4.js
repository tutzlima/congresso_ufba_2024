(window.data_bundle_jsonpfunction=window.data_bundle_jsonpfunction||[]).push([[4,7],{115:function(e,t,a){"use strict";a.r(t);var s=a(3),r=a.n(s),n=a(1),i=a(16),o=a(107),l=a.n(o),u=a(4),d=a.n(u),c=a(25),p=a(28),h=a(118),m=a(13),v=a(5),g=a(117),y=a(108);class filter_options_FilterOptionsUI extends u.Component{constructor(...e){super(...e),r()(this,"buttonRef",d.a.createRef()),r()(this,"state",{isPopoverOpen:!1}),r()(this,"togglePopover",(()=>{this.setState((e=>({isPopoverOpen:!e.isPopoverOpen})))})),r()(this,"closePopover",(()=>{var e;this.setState({isPopoverOpen:!1}),null===(e=this.buttonRef.current)||void 0===e||e.focus()}))}render(){const e={id:0,items:[{name:this.props.intl.formatMessage({id:"data.filter.options.enableAllFiltersButtonLabel",defaultMessage:"Enable all"}),icon:"eye",onClick:()=>{this.closePopover(),this.props.onEnableAll()},"data-test-subj":"enableAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.disableAllFiltersButtonLabel",defaultMessage:"Disable all"}),icon:"eyeClosed",onClick:()=>{this.closePopover(),this.props.onDisableAll()},"data-test-subj":"disableAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.pinAllFiltersButtonLabel",defaultMessage:"Pin all"}),icon:"pin",onClick:()=>{this.closePopover(),this.props.onPinAll()},"data-test-subj":"pinAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.unpinAllFiltersButtonLabel",defaultMessage:"Unpin all"}),icon:"pin",onClick:()=>{this.closePopover(),this.props.onUnpinAll()},"data-test-subj":"unpinAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.invertNegatedFiltersButtonLabel",defaultMessage:"Invert inclusion"}),icon:"invert",onClick:()=>{this.closePopover(),this.props.onToggleAllNegated()},"data-test-subj":"invertInclusionAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.invertDisabledFiltersButtonLabel",defaultMessage:"Invert enabled/disabled"}),icon:"eye",onClick:()=>{this.closePopover(),this.props.onToggleAllDisabled()},"data-test-subj":"invertEnableDisableAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.deleteAllFiltersButtonLabel",defaultMessage:"Remove all"}),icon:"trash",onClick:()=>{this.closePopover(),this.props.onRemoveAll()},"data-test-subj":"removeAllFilters"}]};return d.a.createElement(m.EuiPopover,{id:"popoverForAllFilters",className:"globalFilterGroup__allFiltersPopover",isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,button:d.a.createElement(m.EuiButtonIcon,{onClick:this.togglePopover,iconType:"filter","aria-label":this.props.intl.formatMessage({id:"data.filter.options.changeAllFiltersButtonLabel",defaultMessage:"Change all filters"}),title:this.props.intl.formatMessage({id:"data.filter.options.changeAllFiltersButtonLabel",defaultMessage:"Change all filters"}),"data-test-subj":"showFilterActions",buttonRef:this.buttonRef}),anchorPosition:"rightUp",panelPaddingSize:"none",repositionOnScroll:!0},d.a.createElement(m.EuiPopoverTitle,{paddingSize:"m"},d.a.createElement(i.FormattedMessage,{id:"data.filter.searchBar.changeAllFiltersTitle",defaultMessage:"Change all filters"})),d.a.createElement(m.EuiContextMenu,{initialPanelId:0,panels:[e]}))}}const b=Object(i.injectI18n)(filter_options_FilterOptionsUI);var f=a(2);const E=Object(i.injectI18n)((function(e){const t=Object(u.useRef)(null),[a,s]=Object(u.useState)(!1),r=Object(p.useKibana)(),{appName:n,usageCollection:o,uiSettings:h}=r.services;if(!h)return null;const E=null==o?void 0:o.reportUiCounter.bind(o,n);function S(t){e.onFiltersUpdated&&e.onFiltersUpdated(t)}function F(t){null==E||E(c.METRIC_TYPE.CLICK,"filter:added"),s(!1);S([...e.filters,t])}const Q=l()("globalFilterBar",e.className);return d.a.createElement(m.EuiFlexGroup,{className:"globalFilterGroup",gutterSize:"none",alignItems:"flexStart",responsive:!1},d.a.createElement(m.EuiFlexItem,{className:"globalFilterGroup__branch",grow:!1},d.a.createElement(b,{onEnableAll:function(){null==E||E(c.METRIC_TYPE.CLICK,"filter:enable_all"),S(e.filters.map(v.s))},onDisableAll:function(){null==E||E(c.METRIC_TYPE.CLICK,"filter:disable_all"),S(e.filters.map(v.r))},onPinAll:function(){null==E||E(c.METRIC_TYPE.CLICK,"filter:pin_all"),S(e.filters.map(v.O))},onUnpinAll:function(){null==E||E(c.METRIC_TYPE.CLICK,"filter:unpin_all"),S(e.filters.map(v.U))},onToggleAllNegated:function(){null==E||E(c.METRIC_TYPE.CLICK,"filter:invert_all"),S(e.filters.map(v.R))},onToggleAllDisabled:function(){null==E||E(c.METRIC_TYPE.CLICK,"filter:toggle_all"),S(e.filters.map(v.Q))},onRemoveAll:function(){null==E||E(c.METRIC_TYPE.CLICK,"filter:remove_all"),S([])}})),d.a.createElement(m.EuiFlexItem,{className:"globalFilterGroup__filterFlexItem"},d.a.createElement(m.EuiFlexGroup,{ref:t,className:Q,wrap:!0,responsive:!1,gutterSize:"xs",alignItems:"center",tabIndex:-1},e.filters.map(((a,s)=>d.a.createElement(m.EuiFlexItem,{key:s,grow:!1,className:"globalFilterBar__flexItem"},d.a.createElement(y.FilterItem,{id:`${s}`,intl:e.intl,filter:a,onUpdate:t=>function(t,a){null==E||E(c.METRIC_TYPE.CLICK,"filter:edited");const s=[...e.filters];s[t]=a,S(s)}(s,t),onRemove:()=>function(a){var s;null==E||E(c.METRIC_TYPE.CLICK,"filter:removed");const r=[...e.filters];r.splice(a,1),S(r),null===(s=t.current)||void 0===s||s.focus()}(s),indexPatterns:e.indexPatterns,uiSettings:h,timeRangeForSuggestionsOverride:e.timeRangeForSuggestionsOverride})))),function(){const t=h.get(f.UI_SETTINGS.FILTERS_PINNED_BY_DEFAULT),[r]=e.indexPatterns,n=r&&r.id,o=Object(v.e)(t,n),l=d.a.createElement(m.EuiButtonEmpty,{size:"s",onClick:()=>s(!0),"data-test-subj":"addFilter",className:"globalFilterBar__addButton"},"+"," ",d.a.createElement(i.FormattedMessage,{id:"data.filter.filterBar.addFilterButtonLabel",defaultMessage:"Add filter"}));return d.a.createElement(m.EuiFlexItem,{grow:!1},d.a.createElement(m.EuiPopover,{id:"addFilterPopover",button:l,isOpen:a,closePopover:()=>s(!1),anchorPosition:"downLeft",panelPaddingSize:"none",initialFocus:".filterEditor__hiddenItem",ownFocus:!0,repositionOnScroll:!0},d.a.createElement(m.EuiFlexItem,{grow:!1},d.a.createElement("div",{style:{width:y.FILTER_EDITOR_WIDTH,maxWidth:"100%"}},d.a.createElement(g.a,{filter:o,indexPatterns:e.indexPatterns,onSubmit:F,onCancel:()=>s(!1),key:JSON.stringify(o),timeRangeForSuggestionsOverride:e.timeRangeForSuggestionsOverride})))))}())))}));var S=a(0);function F({savedQuery:e,savedQueryService:t,onSave:a,onClose:s,showFilterOption:r=!0,showTimeFilterOption:i=!0}){var o,l,c,p;const[h,v]=Object(u.useState)(null!==(o=null==e?void 0:e.attributes.title)&&void 0!==o?o:""),[g,y]=Object(u.useState)(Boolean(e)),[b,f]=Object(u.useState)(null!==(l=null==e?void 0:e.attributes.description)&&void 0!==l?l:""),[E,F]=Object(u.useState)([]),[Q,T]=Object(u.useState)(Boolean(null===(c=null==e?void 0:e.attributes.filters)||void 0===c||c)),[P,C]=Object(u.useState)(Boolean(null!==(p=null==e?void 0:e.attributes.timefilter)&&void 0!==p&&p)),[R,B]=Object(u.useState)([]),w=S.i18n.translate("data.search.searchBar.savedQueryForm.titleConflictText",{defaultMessage:"Name conflicts with an existing saved query"}),I=S.i18n.translate("data.search.searchBar.savedQueryDescriptionText",{defaultMessage:"Save query text and filters that you want to use again."});Object(u.useEffect)((()=>{(async()=>{const e=await t.getAllSavedQueries(),a=Object(n.sortBy)(e,"attributes.title");F(a)})()}),[t]);const M=Object(u.useCallback)((()=>{const t=[];return E.find((t=>!e&&t.attributes.title===h))&&t.push(w),Object(n.isEqual)(t,R)?!R.length:(B(t),!1)}),[E,e,h,w,R]),q=Object(u.useCallback)((()=>{M()&&a({id:null==e?void 0:e.id,title:h,description:b,shouldIncludeFilters:Q,shouldIncludeTimefilter:P})}),[M,a,null==e?void 0:e.id,h,b,Q,P]),O=Object(u.useCallback)((e=>{y(Boolean(e.target.value)),B([]),v(e.target.value)}),[]),j=Object(u.useCallback)((()=>{const e=h.trim();h.length>e.length&&v(e)}),[h]),x=R.length>0,_=d.a.createElement(m.EuiForm,{isInvalid:x,error:R,"data-test-subj":"saveQueryForm"},d.a.createElement(m.EuiFormRow,null,d.a.createElement(m.EuiText,{color:"subdued"},I)),d.a.createElement(m.EuiFormRow,{label:S.i18n.translate("data.search.searchBar.savedQueryNameLabelText",{defaultMessage:"Name"}),helpText:S.i18n.translate("data.search.searchBar.savedQueryNameHelpText",{defaultMessage:"Name is required, it cannot contain leading or trailing whitespace and must be unique."}),isInvalid:x},d.a.createElement(m.EuiFieldText,{disabled:!!e,value:h,name:"title",onChange:O,"data-test-subj":"saveQueryFormTitle",isInvalid:x,onBlur:j})),d.a.createElement(m.EuiFormRow,{label:S.i18n.translate("data.search.searchBar.savedQueryDescriptionLabelText",{defaultMessage:"Description"})},d.a.createElement(m.EuiFieldText,{value:b,name:"description",onChange:e=>{f(e.target.value)},"data-test-subj":"saveQueryFormDescription"})),r&&d.a.createElement(m.EuiFormRow,null,d.a.createElement(m.EuiSwitch,{name:"shouldIncludeFilters",label:S.i18n.translate("data.search.searchBar.savedQueryIncludeFiltersLabelText",{defaultMessage:"Include filters"}),checked:Q,onChange:()=>{T(!Q)},"data-test-subj":"saveQueryFormIncludeFiltersOption"})),i&&d.a.createElement(m.EuiFormRow,null,d.a.createElement(m.EuiSwitch,{name:"shouldIncludeTimefilter",label:S.i18n.translate("data.search.searchBar.savedQueryIncludeTimeFilterLabelText",{defaultMessage:"Include time filter"}),checked:P,onChange:()=>{C(!P)},"data-test-subj":"saveQueryFormIncludeTimeFilterOption"})));return d.a.createElement(m.EuiModal,{onClose:s,initialFocus:"[name=title]"},d.a.createElement(m.EuiModalHeader,null,d.a.createElement(m.EuiModalHeaderTitle,null,S.i18n.translate("data.search.searchBar.savedQueryFormTitle",{defaultMessage:"Save query"}))),d.a.createElement(m.EuiModalBody,null,_),d.a.createElement(m.EuiModalFooter,null,d.a.createElement(m.EuiButtonEmpty,{onClick:s,"data-test-subj":"savedQueryFormCancelButton"},S.i18n.translate("data.search.searchBar.savedQueryFormCancelButtonText",{defaultMessage:"Cancel"})),d.a.createElement(m.EuiButton,{onClick:q,fill:!0,"data-test-subj":"savedQueryFormSaveButton",disabled:x||!g},S.i18n.translate("data.search.searchBar.savedQueryFormSaveButtonText",{defaultMessage:"Save"}))))}const Q=({savedQuery:e,isSelected:t,onSelect:a,onDelete:s,showWriteOperations:r})=>{const[n,i]=Object(u.useState)(!1),o=t?S.i18n.translate("data.search.searchBar.savedQueryPopoverSavedQueryListItemSelectedButtonAriaLabel",{defaultMessage:"Saved query button selected {savedQueryName}. Press to clear any changes.",values:{savedQueryName:e.attributes.title}}):S.i18n.translate("data.search.searchBar.savedQueryPopoverSavedQueryListItemButtonAriaLabel",{defaultMessage:"Saved query button {savedQueryName}",values:{savedQueryName:e.attributes.title}}),c=t?`load-saved-query-${e.attributes.title}-button saved-query-list-item-selected`:`load-saved-query-${e.attributes.title}-button`,p=l()("kbnSavedQueryListItem",{"kbnSavedQueryListItem-selected":t}),h=d.a.createElement("span",{className:"kbnSavedQueryListItem__label"},d.a.createElement("span",{className:"kbnSavedQueryListItem__labelText"},e.attributes.title)," ",e.attributes.description&&d.a.createElement(m.EuiIconTip,{type:"iInCircle",content:e.attributes.description,"aria-label":S.i18n.translate("data.search.searchBar.savedQueryPopoverSavedQueryListItemDescriptionAriaLabel",{defaultMessage:"{savedQueryName} description",values:{savedQueryName:e.attributes.title}})}));return d.a.createElement(u.Fragment,null,d.a.createElement(m.EuiListGroupItem,{className:p,key:e.id,"data-test-subj":`saved-query-list-item ${c} ${t?"saved-query-list-item-selected":""}`,isActive:t,onClick:()=>{a(e)},"aria-label":o,label:h,iconType:t?"check":void 0,extraAction:r?{color:"danger",onClick:()=>i(!0),iconType:"trash",iconSize:"s","aria-label":S.i18n.translate("data.search.searchBar.savedQueryPopoverDeleteButtonAriaLabel",{defaultMessage:"Delete saved query {savedQueryName}",values:{savedQueryName:e.attributes.title}}),title:S.i18n.translate("data.search.searchBar.savedQueryPopoverDeleteButtonAriaLabel",{defaultMessage:"Delete saved query {savedQueryName}",values:{savedQueryName:e.attributes.title}}),"data-test-subj":`delete-saved-query-${e.attributes.title}-button`}:void 0}),n&&d.a.createElement(m.EuiConfirmModal,{title:S.i18n.translate("data.search.searchBar.savedQueryPopoverConfirmDeletionTitle",{defaultMessage:'Delete "{savedQueryName}"?',values:{savedQueryName:e.attributes.title}}),confirmButtonText:S.i18n.translate("data.search.searchBar.savedQueryPopoverConfirmDeletionConfirmButtonText",{defaultMessage:"Delete"}),cancelButtonText:S.i18n.translate("data.search.searchBar.savedQueryPopoverConfirmDeletionCancelButtonText",{defaultMessage:"Cancel"}),onConfirm:()=>{s(e),i(!1)},buttonColor:"danger",onCancel:()=>{i(!1)}}))};function T({showSaveQuery:e,loadedSavedQuery:t,onSave:a,onSaveAsNew:s,onLoad:r,onClearSavedQuery:i,savedQueryService:o}){const[l,c]=Object(u.useState)(!1),[p,h]=Object(u.useState)([]),[v,g]=Object(u.useState)(0),[y,b]=Object(u.useState)(0),f=Object(u.useRef)((()=>{}));Object(u.useEffect)((()=>{l&&(async()=>{f.current();let e=!1;f.current=()=>{e=!0};const{total:t,queries:a}=await o.findSavedQueries("",50,y+1);if(e)return;const s=Object(n.sortBy)(a,"attributes.title");g(t),h(s)})()}),[l,y,o]);const E=Object(u.useCallback)((()=>c((e=>!e))),[c]),F=Object(u.useCallback)((()=>c(!1)),[]),T=Object(u.useCallback)((()=>{F(),a()}),[F,a]),P=Object(u.useCallback)((()=>{F(),s()}),[F,s]),C=Object(u.useCallback)((e=>{F(),r(e)}),[F,r]),R=Object(u.useCallback)((e=>{(async e=>{f.current(),h(p.filter((t=>t.id!==e.id))),t&&t.id===e.id&&i(),await o.deleteSavedQuery(e.id),b(0)})(e),F()}),[F,t,i,p,o]),B=S.i18n.translate("data.search.searchBar.savedQueryDescriptionText",{defaultMessage:"Save query text and filters that you want to use again."}),w=S.i18n.translate("data.search.searchBar.savedQueryNoSavedQueriesText",{defaultMessage:"There are no saved queries."})+" "+B,I=S.i18n.translate("data.search.searchBar.savedQueryPopoverTitleText",{defaultMessage:"Saved Queries"}),M=d.a.createElement(m.EuiButtonEmpty,{onClick:E,"aria-label":S.i18n.translate("data.search.searchBar.savedQueryPopoverButtonText",{defaultMessage:"See saved queries"}),title:S.i18n.translate("data.search.searchBar.savedQueryPopoverButtonText",{defaultMessage:"See saved queries"}),"data-test-subj":"saved-query-management-popover-button"},d.a.createElement(m.EuiIcon,{type:"save",className:"euiQuickSelectPopover__buttonText"}),d.a.createElement(m.EuiIcon,{type:"arrowDown"}));return d.a.createElement(u.Fragment,null,d.a.createElement(m.EuiPopover,{id:"savedQueryPopover",button:M,isOpen:l,closePopover:F,anchorPosition:"downLeft",panelPaddingSize:"none",buffer:-8,repositionOnScroll:!0,ownFocus:!0},d.a.createElement("div",{className:"kbnSavedQueryManagement__popover","data-test-subj":"saved-query-management-popover"},d.a.createElement(m.EuiPopoverTitle,{paddingSize:"m",id:"savedQueryManagementPopoverTitle"},I),p.length>0?d.a.createElement(u.Fragment,null,d.a.createElement(m.EuiText,{size:"s",color:"subdued",className:"kbnSavedQueryManagement__text"},d.a.createElement("p",null,B)),d.a.createElement("div",{className:"kbnSavedQueryManagement__listWrapper"},d.a.createElement(m.EuiListGroup,{flush:!0,className:"kbnSavedQueryManagement__list","aria-labelledby":"savedQueryManagementPopoverTitle"},(()=>{const a=p.filter((e=>!t||e.id!==t.id));return(t&&a.length!==p.length?[t,...a]:[...a]).map((a=>d.a.createElement(Q,{key:a.id,savedQuery:a,isSelected:!!t&&t.id===a.id,onSelect:C,onDelete:R,showWriteOperations:!!e})))})())),d.a.createElement(m.EuiPagination,{className:"kbnSavedQueryManagement__pagination",pageCount:Math.ceil(v/50),activePage:y,onPageClick:e=>{b(e)}})):d.a.createElement(u.Fragment,null,d.a.createElement(m.EuiText,{size:"s",color:"subdued",className:"kbnSavedQueryManagement__text"},d.a.createElement("p",null,w)),d.a.createElement(m.EuiSpacer,{size:"s"})),d.a.createElement(m.EuiPopoverFooter,{paddingSize:"m"},d.a.createElement(m.EuiFlexGroup,{direction:"rowReverse",gutterSize:"s",alignItems:"center",justifyContent:"flexEnd",responsive:!1,wrap:!0},e&&t&&d.a.createElement(u.Fragment,null,d.a.createElement(m.EuiFlexItem,{grow:!1},d.a.createElement(m.EuiButton,{size:"s",fill:!0,onClick:T,"aria-label":S.i18n.translate("data.search.searchBar.savedQueryPopoverSaveChangesButtonAriaLabel",{defaultMessage:"Save changes to {title}",values:{title:t.attributes.title}}),"data-test-subj":"saved-query-management-save-changes-button"},S.i18n.translate("data.search.searchBar.savedQueryPopoverSaveChangesButtonText",{defaultMessage:"Save changes"}))),d.a.createElement(m.EuiFlexItem,{grow:!1},d.a.createElement(m.EuiButton,{size:"s",onClick:P,"aria-label":S.i18n.translate("data.search.searchBar.savedQueryPopoverSaveAsNewButtonAriaLabel",{defaultMessage:"Save as new saved query"}),"data-test-subj":"saved-query-management-save-as-new-button"},S.i18n.translate("data.search.searchBar.savedQueryPopoverSaveAsNewButtonText",{defaultMessage:"Save as new"})))),e&&!t&&d.a.createElement(m.EuiFlexItem,{grow:!1},d.a.createElement(m.EuiButton,{size:"s",fill:!0,onClick:T,"aria-label":S.i18n.translate("data.search.searchBar.savedQueryPopoverSaveButtonAriaLabel",{defaultMessage:"Save a new saved query"}),"data-test-subj":"saved-query-management-save-button"},S.i18n.translate("data.search.searchBar.savedQueryPopoverSaveButtonText",{defaultMessage:"Save current query"}))),d.a.createElement(m.EuiFlexItem,null),d.a.createElement(m.EuiFlexItem,{grow:!1},t&&d.a.createElement(m.EuiButtonEmpty,{size:"s",flush:"left",onClick:i,"aria-label":S.i18n.translate("data.search.searchBar.savedQueryPopoverClearButtonAriaLabel",{defaultMessage:"Clear current saved query"}),"data-test-subj":"saved-query-management-clear-button"},S.i18n.translate("data.search.searchBar.savedQueryPopoverClearButtonText",{defaultMessage:"Clear"}))))))))}class search_bar_SearchBarUI extends u.Component{constructor(...e){super(...e),r()(this,"services",this.props.kibana.services),r()(this,"savedQueryService",this.services.data.query.savedQueries),r()(this,"state",{isFiltersVisible:!0,showSaveQueryModal:!1,showSaveNewQueryModal:!1,showSavedQueryPopover:!1,currentProps:this.props,query:this.props.query?{...this.props.query}:void 0,dateRangeFrom:Object(n.get)(this.props,"dateRangeFrom","now-15m"),dateRangeTo:Object(n.get)(this.props,"dateRangeTo","now")}),r()(this,"isDirty",(()=>!this.props.showDatePicker&&this.state.query&&this.props.query?this.state.query.query!==this.props.query.query:this.state.query&&this.props.query&&this.state.query.query!==this.props.query.query||this.state.dateRangeFrom!==this.props.dateRangeFrom||this.state.dateRangeTo!==this.props.dateRangeTo)),r()(this,"onSave",(async(e,t=!1)=>{if(!this.state.query)return;const a={title:e.title,description:e.description,query:this.state.query};e.shouldIncludeFilters&&(a.filters=this.props.filters),e.shouldIncludeTimefilter&&void 0!==this.state.dateRangeTo&&void 0!==this.state.dateRangeFrom&&void 0!==this.props.refreshInterval&&void 0!==this.props.isRefreshPaused&&(a.timefilter={from:this.state.dateRangeFrom,to:this.state.dateRangeTo,refreshInterval:{value:this.props.refreshInterval,pause:this.props.isRefreshPaused}});try{let s;s=this.props.savedQuery&&!t?await this.savedQueryService.updateQuery(e.id,a):await this.savedQueryService.createQuery(a),this.services.notifications.toasts.addSuccess(`Your query "${s.attributes.title}" was saved`),this.setState({showSaveQueryModal:!1,showSaveNewQueryModal:!1}),this.props.onSaved&&this.props.onSaved(s)}catch(e){throw this.services.notifications.toasts.addDanger(`An error occured while saving your query: ${e.message}`),e}})),r()(this,"onInitiateSave",(()=>{this.setState({showSaveQueryModal:!0})})),r()(this,"onInitiateSaveNew",(()=>{this.setState({showSaveNewQueryModal:!0})})),r()(this,"onQueryBarChange",(e=>{this.setState({query:e.query,dateRangeFrom:e.dateRange.from,dateRangeTo:e.dateRange.to}),this.props.onQueryChange&&this.props.onQueryChange(e)})),r()(this,"onQueryBarSubmit",(e=>{this.setState({query:e.query,dateRangeFrom:e.dateRange&&e.dateRange.from||this.state.dateRangeFrom,dateRangeTo:e.dateRange&&e.dateRange.to||this.state.dateRangeTo},(()=>{var e;this.props.onQuerySubmit&&this.props.onQuerySubmit({query:this.state.query,dateRange:{from:this.state.dateRangeFrom,to:this.state.dateRangeTo}}),null===(e=this.services.usageCollection)||void 0===e||e.reportUiCounter(this.services.appName,c.METRIC_TYPE.CLICK,"query_submitted")}))})),r()(this,"onLoadSavedQuery",(e=>{const t=Object(n.get)(e,"attributes.timefilter.from",this.state.dateRangeFrom),a=Object(n.get)(e,"attributes.timefilter.to",this.state.dateRangeTo);this.setState({query:e.attributes.query,dateRangeFrom:t,dateRangeTo:a}),this.props.onSavedQueryUpdated&&this.props.onSavedQueryUpdated(e)}))}static getDerivedStateFromProps(e,t){if(Object(n.isEqual)(t.currentProps,e))return null;let a=null;e.query&&e.query.query!==Object(n.get)(t,"currentProps.query.query")?a={query:e.query.query,language:e.query.language}:e.query&&t.query&&e.query.language!==t.query.language&&(a={query:"",language:e.query.language});let s=null;e.dateRangeFrom===Object(n.get)(t,"currentProps.dateRangeFrom")&&e.dateRangeTo===Object(n.get)(t,"currentProps.dateRangeTo")||(s={dateRangeFrom:e.dateRangeFrom,dateRangeTo:e.dateRangeTo});const r={currentProps:e};return a&&(r.query=a),s&&(r.dateRangeFrom=s.dateRangeFrom,r.dateRangeTo=s.dateRangeTo),r}shouldRenderQueryBar(){const e=this.props.showDatePicker||this.props.showAutoRefreshOnly,t=this.props.showQueryInput&&this.props.indexPatterns&&this.state.query;return this.props.showQueryBar&&(e||t)}shouldRenderFilterBar(){return this.props.showFilterBar&&this.props.filters&&this.props.indexPatterns&&Object(n.compact)(this.props.indexPatterns).length>0}shouldRenderTimeFilterInSavedQueryForm(){const{dateRangeFrom:e,dateRangeTo:t,showDatePicker:a}=this.props;return a||!a&&void 0!==e&&void 0!==t}render(){const e=this.state.query&&this.props.onClearSavedQuery&&d.a.createElement(T,{showSaveQuery:this.props.showSaveQuery,loadedSavedQuery:this.props.savedQuery,onSave:this.onInitiateSave,onSaveAsNew:this.onInitiateSaveNew,onLoad:this.onLoadSavedQuery,savedQueryService:this.savedQueryService,onClearSavedQuery:this.props.onClearSavedQuery}),t=!!this.props.showDatePicker&&void 0;let a,s;if(this.shouldRenderQueryBar()&&(a=d.a.createElement(h.default,{timeHistory:this.props.timeHistory,query:this.state.query,screenTitle:this.props.screenTitle,onSubmit:this.onQueryBarSubmit,indexPatterns:this.props.indexPatterns,isLoading:this.props.isLoading,prepend:this.props.showFilterBar?e:void 0,showDatePicker:this.props.showDatePicker,dateRangeFrom:this.state.dateRangeFrom,dateRangeTo:this.state.dateRangeTo,isRefreshPaused:this.props.isRefreshPaused,refreshInterval:this.props.refreshInterval,showAutoRefreshOnly:this.props.showAutoRefreshOnly,showQueryInput:this.props.showQueryInput,onRefresh:this.props.onRefresh,onRefreshChange:this.props.onRefreshChange,onChange:this.onQueryBarChange,isDirty:this.isDirty(),customSubmitButton:this.props.customSubmitButton?this.props.customSubmitButton:void 0,dataTestSubj:this.props.dataTestSubj,indicateNoData:this.props.indicateNoData,placeholder:this.props.placeholder,isClearable:this.props.isClearable,iconType:this.props.iconType,nonKqlMode:this.props.nonKqlMode,nonKqlModeHelpText:this.props.nonKqlModeHelpText,timeRangeForSuggestionsOverride:t})),this.shouldRenderFilterBar()){const e=l()("globalFilterGroup__wrapper",{"globalFilterGroup__wrapper-isVisible":this.state.isFiltersVisible});s=d.a.createElement("div",{id:"GlobalFilterGroup",className:e},d.a.createElement(E,{className:"globalFilterGroup__filterBar",filters:this.props.filters,onFiltersUpdated:this.props.onFiltersUpdated,indexPatterns:this.props.indexPatterns,appName:this.services.appName,timeRangeForSuggestionsOverride:t}))}const r=l()("globalQueryBar",{"globalQueryBar--inPage":"inPage"===this.props.displayStyle});return d.a.createElement("div",{className:r,"data-test-subj":"globalQueryBar"},a,s,this.state.showSaveQueryModal?d.a.createElement(F,{savedQuery:this.props.savedQuery?this.props.savedQuery:void 0,savedQueryService:this.savedQueryService,onSave:this.onSave,onClose:()=>this.setState({showSaveQueryModal:!1}),showFilterOption:this.props.showFilterBar,showTimeFilterOption:this.shouldRenderTimeFilterInSavedQueryForm()}):null,this.state.showSaveNewQueryModal?d.a.createElement(F,{savedQueryService:this.savedQueryService,onSave:e=>this.onSave(e,!0),onClose:()=>this.setState({showSaveNewQueryModal:!1}),showFilterOption:this.props.showFilterBar,showTimeFilterOption:this.shouldRenderTimeFilterInSavedQueryForm()}):null)}}r()(search_bar_SearchBarUI,"defaultProps",{showQueryBar:!0,showFilterBar:!0,showDatePicker:!0,showAutoRefreshOnly:!1});t.default=Object(i.injectI18n)(Object(p.withKibana)(search_bar_SearchBarUI))},118:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return S}));var s=a(19),r=a.n(s),n=a(107),i=a.n(n),o=a(4),l=a.n(o),u=a(13),d=a(28),c=a(119),p=a(2),h=a(20),m=a(0);const v="data.noDataPopover";function g({showNoDataPopover:e,storage:t,children:a}){const[s,r]=Object(o.useState)((()=>Boolean(t.get(v)))),[n,i]=Object(o.useState)(!1);return Object(o.useEffect)((()=>{e&&!s&&i(!0)}),[s,e]),l.a.createElement(u.EuiTourStep,{onFinish:()=>{},closePopover:()=>{i(!1)},content:l.a.createElement(u.EuiText,{size:"s"},l.a.createElement("p",{style:{maxWidth:300}},m.i18n.translate("data.noDataPopover.content",{defaultMessage:"This time range doesn't contain any data. Increase or adjust the time range to see more fields and create charts."}))),minWidth:300,anchorPosition:"downCenter",anchorClassName:"eui-displayBlock",step:1,stepsTotal:1,isStepOpen:n,subtitle:m.i18n.translate("data.noDataPopover.subtitle",{defaultMessage:"Tip"}),title:m.i18n.translate("data.noDataPopover.title",{defaultMessage:"Empty dataset"}),footerAction:l.a.createElement(u.EuiButtonEmpty,{size:"xs",flush:"right",color:"text","data-test-subj":"noDataPopoverDismissButton",onClick:()=>{t.set(v,!0),r(!0),i(!1)}},m.i18n.translate("data.noDataPopover.dismissAction",{defaultMessage:"Don't show again"}))},l.a.createElement("div",{onFocus:()=>{i(!1)}},a))}var y=a(16);const b="data.autocompleteFtuePopover";function f({isVisible:e,storage:t,children:a}){const s=Object(d.useKibana)().services.docLinks.links.query.autocompleteChanges,[r,n]=Object(o.useState)((()=>Boolean(t.get(b)))),[i,c]=Object(o.useState)(!1);return Object(o.useEffect)((()=>{!r&&e&&c(!0)}),[r,e]),l.a.createElement(u.EuiTourStep,{onFinish:()=>{},closePopover:()=>{c(!1),n(!0)},content:l.a.createElement(u.EuiText,{size:"s",style:{maxWidth:"300px"}},l.a.createElement(y.FormattedMessage,{id:"data.autocompleteFtuePopover.content",defaultMessage:"We changed how autocomplete works to improve performance. {learnMoreLink}",values:{learnMoreLink:l.a.createElement(u.EuiLink,{href:s,target:"_blank",external:!0},m.i18n.translate("data.autocompleteFtuePopover.learnMoreLink",{defaultMessage:"Learn more."}))}})),minWidth:300,anchorPosition:"downCenter",zIndex:4002,anchorClassName:"eui-displayBlock",step:1,stepsTotal:1,isStepOpen:i,subtitle:"",title:m.i18n.translate("data.autocompleteFtuePopover.title",{defaultMessage:"Autocomplete is now faster!"}),footerAction:l.a.createElement(u.EuiButtonEmpty,{size:"xs",flush:"right",color:"text","data-test-subj":"autocompleteFtuePopoverDismissButton",onClick:()=>{t.set(b,!0),n(!0),c(!1)}},m.i18n.translate("data.autocompleteFtuePopover.dismissAction",{defaultMessage:"Don't show again"}))},l.a.createElement("div",{onFocus:()=>{c(!1)}},a))}const E=Object(d.withKibana)(c.default);function S(e){const[t,a]=Object(o.useState)(!1),[s,n]=Object(o.useState)(!1),c=Object(d.useKibana)(),{uiSettings:m,storage:v,appName:y}=c.services,b=e.query&&e.query.language,S=l.a.useMemo((()=>b&&m&&v&&y?Object(h.o)(m,v,y,b):void 0),[y,b,m,v]);function F(t){S&&e.query&&S.add(e.query.query),t.preventDefault(),B({query:e.query,dateRange:Q()})}function Q(){const t=m.get(p.UI_SETTINGS.TIMEPICKER_TIME_DEFAULTS);return{from:e.dateRangeFrom||t.from,to:e.dateRangeTo||t.to}}function T(t){e.onChange({query:t,dateRange:Q()})}function P(e){n(e)}function C({start:t,end:s,isInvalid:r,isQuickSelection:n}){a(r);const i={query:e.query,dateRange:{from:t,to:s}};n?e.onSubmit(i):e.onChange(i)}function R({start:t,end:a}){const s={dateRange:{from:t,to:a}};e.onRefresh&&e.onRefresh(s)}function B({query:t,dateRange:a}){e.timeHistory&&e.timeHistory.add(a),e.onSubmit({query:t,dateRange:a})}function w(e){B({query:e,dateRange:Q()})}function I(e,t=!1){const a=r.a.parse(e,{roundUp:t});return a?a.toISOString():e}function M(){return Boolean(e.showDatePicker||e.showAutoRefreshOnly)}const q=i()("kbnQueryBar",{"kbnQueryBar--withDatePicker":e.showDatePicker});return l.a.createElement(u.EuiFlexGroup,{className:q,responsive:!!e.showDatePicker,gutterSize:"s",justifyContent:"flexEnd"},function(){if(Boolean(e.showQueryInput&&e.indexPatterns&&e.query&&v))return l.a.createElement(u.EuiFlexItem,null,l.a.createElement(f,{storage:v,isVisible:s},l.a.createElement(E,{disableAutoFocus:e.disableAutoFocus,indexPatterns:e.indexPatterns,prepend:e.prepend,query:e.query,screenTitle:e.screenTitle,onChange:T,onChangeQueryInputFocus:P,onSubmit:w,persistedLog:S,dataTestSubj:e.dataTestSubj,placeholder:e.placeholder,isClearable:e.isClearable,iconType:e.iconType,nonKqlMode:e.nonKqlMode,nonKqlModeHelpText:e.nonKqlModeHelpText,timeRangeForSuggestionsOverride:e.timeRangeForSuggestionsOverride})))}(),function(){const{from:e,to:t}=Q(),a=Object(u.prettyDuration)(I(e),I(t),[],m.get("dateFormat"));return l.a.createElement("div",{"data-shared-timefilter-duration":a,"data-test-subj":"dataSharedTimefilterDuration"})}(),l.a.createElement(u.EuiFlexItem,{grow:!1},function(){const a=e.customSubmitButton?l.a.cloneElement(e.customSubmitButton,{onClick:F}):l.a.createElement(u.EuiSuperUpdateButton,{needsUpdate:e.isDirty,isDisabled:t,isLoading:e.isLoading,onClick:F,"data-test-subj":"querySubmitButton"});return M()?l.a.createElement(g,{storage:v,showNoDataPopover:e.indicateNoData},l.a.createElement(u.EuiFlexGroup,{responsive:!1,gutterSize:"s"},function(){if(!M())return null;let t;e.timeHistory&&(t=e.timeHistory.get().map((({from:e,to:t})=>({start:e,end:t}))));const a=m.get(p.UI_SETTINGS.TIMEPICKER_QUICK_RANGES).map((({from:e,to:t,display:a})=>({start:e,end:t,label:a}))),r=i()("kbnQueryBar__datePickerWrapper",{"kbnQueryBar__datePickerWrapper-isHidden":s});return l.a.createElement(u.EuiFlexItem,{className:r},l.a.createElement(u.EuiSuperDatePicker,{start:e.dateRangeFrom,end:e.dateRangeTo,isPaused:e.isRefreshPaused,refreshInterval:e.refreshInterval,onTimeChange:C,onRefresh:R,onRefreshChange:e.onRefreshChange,showUpdateButton:!1,recentlyUsedRanges:t,commonlyUsedRanges:a,dateFormat:m.get("dateFormat"),isAutoRefreshOnly:e.showAutoRefreshOnly,className:"kbnQueryBar__datePicker"}))}(),l.a.createElement(u.EuiFlexItem,{grow:!1},a))):a}()))}S.defaultProps={showQueryInput:!0,showDatePicker:!0,showAutoRefreshOnly:!1}}}]);